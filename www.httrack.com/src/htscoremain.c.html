<!DOCTYPE html PUBLIC "-//IETF//DTD HTML 2.0//EN">
<HTML>

<!-- Mirrored from www.httrack.com/src/htscoremain.c.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 02 Jan 2023 20:31:44 GMT -->
<HEAD>
<TITLE>./htscoremain.c - HTTrack Website Copier</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#1F00FF" ALINK="#FF0000" VLINK="#9900DD">
<A NAME="top">
<A NAME="file1">
<H1>./htscoremain.c</H1>

<PRE>
<I><FONT COLOR="#B22222">/* ------------------------------------------------------------ */</FONT></I>
<I><FONT COLOR="#B22222">/*
HTTrack Website Copier, Offline Browser for Windows and Unix
Copyright (C) 1998-2015 Xavier Roche and other contributors

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.

Important notes:

- We hereby ask people using this source NOT to use it in purpose of grabbing
emails addresses, or collecting any other private information on persons.
This would disgrace our work, and spoil the many hours we spent on it.

Please visit our Website: http://www.httrack.com
*/</FONT></I>

<I><FONT COLOR="#B22222">/* ------------------------------------------------------------ */</FONT></I>
<I><FONT COLOR="#B22222">/* File: opt-&gt;c subroutines:                                 */</FONT></I>
<I><FONT COLOR="#B22222">/*       main routine (first called)                            */</FONT></I>
<I><FONT COLOR="#B22222">/* Author: Xavier Roche                                         */</FONT></I>
<I><FONT COLOR="#B22222">/* ------------------------------------------------------------ */</FONT></I>

<I><FONT COLOR="#B22222">/* Internal engine bytecode */</FONT></I>
#<B><FONT COLOR="#5F9EA0">define</FONT></B> <FONT COLOR="#B8860B">HTS_INTERNAL_BYTECODE</FONT>

#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;htscoremain.h&quot;</FONT></B>

#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;htsglobal.h&quot;</FONT></B>
#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;htscore.h&quot;</FONT></B>
#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;htsdefines.h&quot;</FONT></B>
#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;htsalias.h&quot;</FONT></B>
#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;htswrap.h&quot;</FONT></B>
#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;htsmodules.h&quot;</FONT></B>
#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;htszlib.h&quot;</FONT></B>
#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;htscharset.h&quot;</FONT></B>
#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;htsencoding.h&quot;</FONT></B>
#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;htsmd5.h&quot;</FONT></B>

#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&lt;ctype.h&gt;</FONT></B>
#<B><FONT COLOR="#5F9EA0">if</FONT></B> <FONT COLOR="#B8860B">USE_BEGINTHREAD</FONT>
#<B><FONT COLOR="#5F9EA0">ifdef</FONT></B> <FONT COLOR="#B8860B">_WIN32</FONT>
#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&lt;process.h&gt;</FONT></B>
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
#<B><FONT COLOR="#5F9EA0">ifdef</FONT></B> <FONT COLOR="#B8860B">_WIN32</FONT>
#<B><FONT COLOR="#5F9EA0">else</FONT></B>
#<B><FONT COLOR="#5F9EA0">ifndef</FONT></B> <FONT COLOR="#B8860B">HTS_DO_NOT_USE_UID</FONT>
<I><FONT COLOR="#B22222">/* setuid */</FONT></I>
#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&lt;pwd.h&gt;</FONT></B>
#<B><FONT COLOR="#5F9EA0">ifdef</FONT></B> <FONT COLOR="#B8860B">HAVE_UNISTD_H</FONT>
#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&lt;unistd.h&gt;</FONT></B>
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>

<I><FONT COLOR="#B22222">/* Resolver */</FONT></I>
<B><FONT COLOR="#228B22">extern</FONT></B> <B><FONT COLOR="#228B22">int</FONT></B> IPV6_resolver;

<I><FONT COLOR="#B22222">// Add a command in the argc/argv
</FONT></I>#<B><FONT COLOR="#5F9EA0">define</FONT></B> <B><FONT COLOR="#0000FF">cmdl_add</FONT></B>(token,argc,argv,buff,ptr) \
  argv[argc]=(buff+ptr); \
  strcpybuff(argv[argc],token); \
  ptr += (int) (strlen(argv[argc])+2); \
  argc++

<I><FONT COLOR="#B22222">// Insert a command in the argc/argv
</FONT></I>#<B><FONT COLOR="#5F9EA0">define</FONT></B> <B><FONT COLOR="#0000FF">cmdl_ins</FONT></B>(token,argc,argv,buff,ptr) \
  { \
  int i; \
  for(i=argc;i&gt;0;i--)\
  argv[i]=argv[i-1];\
  } \
  argv[0]=(buff+ptr); \
  strcpybuff(argv[0],token); \
  ptr += (int) (strlen(argv[0])+2); \
  argc++

#<B><FONT COLOR="#5F9EA0">define</FONT></B> <B><FONT COLOR="#0000FF">htsmain_free</FONT></B>() do { \
  if (url != NULL) { \
    free(url); \
  } \
} while(0)

#<B><FONT COLOR="#5F9EA0">define</FONT></B> <B><FONT COLOR="#0000FF">ensureUrlCapacity</FONT></B>(url, urlsize, size) do { \
  if (urlsize &lt; size || url == NULL) { \
    urlsize = size; \
    if (url == NULL) { \
      url = (char*) malloct(urlsize); \
      if (url != NULL) url[0]=<B><FONT COLOR="#BC8F8F">'\0'</FONT></B>; \
    } else { \
      url = (char*) realloct(url, urlsize); \
    } \
    if (url == NULL) { \
      HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;* memory exhausted&quot;</FONT></B>); \
      htsmain_free(); \
      return -1; \
    } \
  } \
} while(0)

#<B><FONT COLOR="#5F9EA0">ifdef</FONT></B> <FONT COLOR="#B8860B">HTS_CRASH_TEST</FONT>
<B><FONT COLOR="#228B22">static</FONT></B> <B><FONT COLOR="#0000FF">__attribute__</FONT></B> ((noinline)) <B><FONT COLOR="#228B22">void</FONT></B> fourty_two(<B><FONT COLOR="#228B22">void</FONT></B>) {
  <B><FONT COLOR="#228B22">char</FONT></B> *<B><FONT COLOR="#228B22">const</FONT></B> ptr = (<B><FONT COLOR="#228B22">char</FONT></B>*) (uintptr_t) 0x42;
  (*ptr)++;
}
<B><FONT COLOR="#228B22">static</FONT></B> <B><FONT COLOR="#0000FF">__attribute__</FONT></B> ((noinline)) <B><FONT COLOR="#228B22">void</FONT></B> do_really_crash(<B><FONT COLOR="#228B22">void</FONT></B>) {
  fourty_two();
}
<B><FONT COLOR="#228B22">static</FONT></B> <B><FONT COLOR="#0000FF">__attribute__</FONT></B> ((noinline)) <B><FONT COLOR="#228B22">void</FONT></B> do_crash(<B><FONT COLOR="#228B22">void</FONT></B>) {
  do_really_crash();
}
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>

HTSEXT_API <B><FONT COLOR="#228B22">int</FONT></B> <B><FONT COLOR="#0000FF">hts_main</FONT></B>(<B><FONT COLOR="#228B22">int</FONT></B> argc, <B><FONT COLOR="#228B22">char</FONT></B> **argv) {
  httrackp *opt = hts_create_opt();
  <B><FONT COLOR="#228B22">int</FONT></B> ret = hts_main2(argc, argv, opt);

  hts_free_opt(opt);
  <B><FONT COLOR="#A020F0">return</FONT></B> ret;
}

<I><FONT COLOR="#B22222">// very minimalistic internal tests
</FONT></I><B><FONT COLOR="#228B22">static</FONT></B> <B><FONT COLOR="#228B22">void</FONT></B> <B><FONT COLOR="#0000FF">basic_selftests</FONT></B>(<B><FONT COLOR="#228B22">void</FONT></B>) {
  <I><FONT COLOR="#B22222">// BUG 756328
</FONT></I>  <B><FONT COLOR="#228B22">const</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B> *<B><FONT COLOR="#228B22">const</FONT></B> source = <B><FONT COLOR="#BC8F8F">&quot;/intent/tweet?url=https%3A%2F%2Fwww.httrack.com%2Fvacatures%2F1562519%2Fmedewerker-data-services&amp;text=Medewerker+Data+Services&amp;via=httrackcom&quot;</FONT></B>;
  <B><FONT COLOR="#228B22">char</FONT></B> buffer[1024];
  fil_normalized(source, buffer);
  <I><FONT COLOR="#B22222">// MD5 selftests
</FONT></I>  md5selftest();
}

<B><FONT COLOR="#228B22">static</FONT></B> <B><FONT COLOR="#228B22">int</FONT></B> <B><FONT COLOR="#0000FF">hts_main_internal</FONT></B>(<B><FONT COLOR="#228B22">int</FONT></B> argc, <B><FONT COLOR="#228B22">char</FONT></B> **argv, httrackp * opt);

<I><FONT COLOR="#B22222">// Main, récupère les paramètres et appelle le robot
</FONT></I>HTSEXT_API <B><FONT COLOR="#228B22">int</FONT></B> <B><FONT COLOR="#0000FF">hts_main2</FONT></B>(<B><FONT COLOR="#228B22">int</FONT></B> argc, <B><FONT COLOR="#228B22">char</FONT></B> **argv, httrackp * opt) {
  <B><FONT COLOR="#228B22">int</FONT></B> code;

  <I><FONT COLOR="#B22222">// Set ended state (3.48-14)
</FONT></I>  hts_mutexlock(&amp;opt-&gt;state.lock);
  opt-&gt;state.is_ended = 0;
  hts_mutexrelease(&amp;opt-&gt;state.lock);

  code = hts_main_internal(argc, argv, opt);

  <I><FONT COLOR="#B22222">// Set ended state (3.48-14)
</FONT></I>  hts_mutexlock(&amp;opt-&gt;state.lock);
  opt-&gt;state.is_ended = 1;
  hts_mutexrelease(&amp;opt-&gt;state.lock);

  <B><FONT COLOR="#A020F0">return</FONT></B> code;
}

<B><FONT COLOR="#228B22">static</FONT></B> <B><FONT COLOR="#228B22">int</FONT></B> <B><FONT COLOR="#0000FF">hts_main_internal</FONT></B>(<B><FONT COLOR="#228B22">int</FONT></B> argc, <B><FONT COLOR="#228B22">char</FONT></B> **argv, httrackp * opt) {
  <B><FONT COLOR="#228B22">char</FONT></B> **x_argv = NULL;         <I><FONT COLOR="#B22222">// Patch pour argv et argc: en cas de récupération de ligne de commande
</FONT></I>  <B><FONT COLOR="#228B22">char</FONT></B> *x_argvblk = NULL;       <I><FONT COLOR="#B22222">// (reprise ou update)
</FONT></I>  <B><FONT COLOR="#228B22">int</FONT></B> x_ptr = 0;                <I><FONT COLOR="#B22222">// offset
</FONT></I>
  <I><FONT COLOR="#B22222">//
</FONT></I>  <B><FONT COLOR="#228B22">int</FONT></B> argv_url = -1;            <I><FONT COLOR="#B22222">// ==0 : utiliser cache et doit.log
</FONT></I>  <B><FONT COLOR="#228B22">char</FONT></B> *argv_firsturl = NULL;   <I><FONT COLOR="#B22222">// utilisé pour nommage par défaut
</FONT></I>  <B><FONT COLOR="#228B22">char</FONT></B> *url = NULL;             <I><FONT COLOR="#B22222">// URLS séparées par un espace
</FONT></I>  <B><FONT COLOR="#228B22">int</FONT></B> url_sz = 65535;

  <I><FONT COLOR="#B22222">//char url[65536];         // URLS séparées par un espace
</FONT></I>  <I><FONT COLOR="#B22222">// the parametres
</FONT></I>  <B><FONT COLOR="#228B22">int</FONT></B> httrack_logmode = 3;      <I><FONT COLOR="#B22222">// ONE log file
</FONT></I>
  ensureUrlCapacity(url, url_sz, 65536);

  <I><FONT COLOR="#B22222">// Create options
</FONT></I>  _DEBUG_HEAD = 0;              <I><FONT COLOR="#B22222">// pas de debuggage en têtes
</FONT></I>
  <I><FONT COLOR="#B22222">/* command max-size check (3.43 ; 3.42-4) */</FONT></I>
  {
    <B><FONT COLOR="#228B22">int</FONT></B> i;

    <B><FONT COLOR="#A020F0">for</FONT></B>(i = 0; i &lt; argc; i++) {
      <B><FONT COLOR="#A020F0">if</FONT></B> (strlen(argv[i]) &gt;= HTS_CDLMAXSIZE) {
        HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;argument too long&quot;</FONT></B>);
        htsmain_free();
        <B><FONT COLOR="#A020F0">return</FONT></B> -1;
      }
    }
  }

  <I><FONT COLOR="#B22222">/* Init root dir */</FONT></I>
  hts_rootdir(argv[0]);

#<B><FONT COLOR="#5F9EA0">ifdef</FONT></B> <FONT COLOR="#B8860B">_WIN32</FONT>
#<B><FONT COLOR="#5F9EA0">else</FONT></B>
  <I><FONT COLOR="#B22222">/* Terminal is a tty, may ask questions and display funny information */</FONT></I>
  <B><FONT COLOR="#A020F0">if</FONT></B> (isatty(1)) {
    opt-&gt;quiet = 0;
    opt-&gt;verbosedisplay = 1;
  }
  <I><FONT COLOR="#B22222">/* Not a tty, no stdin input or funny output! */</FONT></I>
  <B><FONT COLOR="#A020F0">else</FONT></B> {
    opt-&gt;quiet = 1;
    opt-&gt;verbosedisplay = 0;
  }
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>

  <I><FONT COLOR="#B22222">// Binary program path?
</FONT></I>#<B><FONT COLOR="#5F9EA0">ifndef</FONT></B> <FONT COLOR="#B8860B">HTS_HTTRACKDIR</FONT>
  {
    <B><FONT COLOR="#228B22">char</FONT></B> catbuff[CATBUFF_SIZE];
    <B><FONT COLOR="#228B22">char</FONT></B> *path = fslash(catbuff, <B><FONT COLOR="#A020F0">sizeof</FONT></B>(catbuff), argv[0]);
    <B><FONT COLOR="#228B22">char</FONT></B> *a;

    <B><FONT COLOR="#A020F0">if</FONT></B> ((a = strrchr(path, <B><FONT COLOR="#BC8F8F">'/'</FONT></B>))) {
      StringCopyN(opt-&gt;path_bin, argv[0], a - path);
    }
  }
#<B><FONT COLOR="#5F9EA0">else</FONT></B>
  StringCopy(opt-&gt;path_bin, HTS_HTTRACKDIR);
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>

  <I><FONT COLOR="#B22222">/* filter CR, LF, TAB.. */</FONT></I>
  {
    <B><FONT COLOR="#228B22">int</FONT></B> na;

    <B><FONT COLOR="#A020F0">for</FONT></B>(na = 1; na &lt; argc; na++) {
      <B><FONT COLOR="#228B22">char</FONT></B> *a;

      <B><FONT COLOR="#A020F0">while</FONT></B>((a = strchr(argv[na], '\x0d')))
        *a = <B><FONT COLOR="#BC8F8F">' '</FONT></B>;
      <B><FONT COLOR="#A020F0">while</FONT></B>((a = strchr(argv[na], '\x0a')))
        *a = <B><FONT COLOR="#BC8F8F">' '</FONT></B>;
      <B><FONT COLOR="#A020F0">while</FONT></B>((a = strchr(argv[na], 9)))
        *a = <B><FONT COLOR="#BC8F8F">' '</FONT></B>;
      <I><FONT COLOR="#B22222">/* equivalent to &quot;empty parameter&quot; */</FONT></I>
      <B><FONT COLOR="#A020F0">if</FONT></B> ((strcmp(argv[na], HTS_NOPARAM) == 0) || (strcmp(argv[na], HTS_NOPARAM2) == 0))        <I><FONT COLOR="#B22222">// (none)
</FONT></I>        strcpybuff(argv[na], <B><FONT COLOR="#BC8F8F">&quot;\&quot;\&quot;&quot;</FONT></B>);
      <B><FONT COLOR="#A020F0">if</FONT></B> (strncmp(argv[na], <B><FONT COLOR="#BC8F8F">&quot;-&amp;&quot;</FONT></B>, 2) == 0)
        argv[na][1] = <B><FONT COLOR="#BC8F8F">'%'</FONT></B>;
    }
  }

  <I><FONT COLOR="#B22222">/* create x_argvblk buffer for transformed command line */</FONT></I>
  {
    <B><FONT COLOR="#228B22">int</FONT></B> current_size = 0;
    <B><FONT COLOR="#228B22">int</FONT></B> size;
    <B><FONT COLOR="#228B22">int</FONT></B> na;

    <B><FONT COLOR="#A020F0">for</FONT></B>(na = 0; na &lt; argc; na++)
      current_size += (<B><FONT COLOR="#228B22">int</FONT></B>) (strlen(argv[na]) + 1);
    <B><FONT COLOR="#A020F0">if</FONT></B> ((size = fsize(<B><FONT COLOR="#BC8F8F">&quot;config&quot;</FONT></B>)) &gt; 0)
      current_size += size;
    x_argvblk = (<B><FONT COLOR="#228B22">char</FONT></B> *) malloct(current_size + 32768);
    <B><FONT COLOR="#A020F0">if</FONT></B> (x_argvblk == NULL) {
      HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;Error, not enough memory&quot;</FONT></B>);
      htsmain_free();
      <B><FONT COLOR="#A020F0">return</FONT></B> -1;
    }
    x_argvblk[0] = <B><FONT COLOR="#BC8F8F">'\0'</FONT></B>;
    x_ptr = 0;

    <I><FONT COLOR="#B22222">/* Create argv */</FONT></I>
    x_argv = (<B><FONT COLOR="#228B22">char</FONT></B> **) malloct(<B><FONT COLOR="#A020F0">sizeof</FONT></B>(<B><FONT COLOR="#228B22">char</FONT></B> *) * (argc + 1024));
  }

  <I><FONT COLOR="#B22222">/* Create new argc/argv, replace alias, count URLs, treat -h, -q, -i */</FONT></I>
  {
    <B><FONT COLOR="#228B22">char</FONT></B> BIGSTK _tmp_argv[2][HTS_CDLMAXSIZE];
    <B><FONT COLOR="#228B22">char</FONT></B> BIGSTK tmp_error[HTS_CDLMAXSIZE];
    <B><FONT COLOR="#228B22">char</FONT></B> *tmp_argv[2];
    <B><FONT COLOR="#228B22">int</FONT></B> tmp_argc;
    <B><FONT COLOR="#228B22">int</FONT></B> x_argc = 0;
    <B><FONT COLOR="#228B22">int</FONT></B> na;

    tmp_argv[0] = _tmp_argv[0];
    tmp_argv[1] = _tmp_argv[1];
    <I><FONT COLOR="#B22222">//
</FONT></I>    argv_url = 0;               <I><FONT COLOR="#B22222">/* pour comptage */</FONT></I>
    <I><FONT COLOR="#B22222">//
</FONT></I>    cmdl_add(argv[0], x_argc, x_argv, x_argvblk, x_ptr);
    na = 1;                     <I><FONT COLOR="#B22222">/* commencer après nom_prg */</FONT></I>
    <B><FONT COLOR="#A020F0">while</FONT></B>(na &lt; argc) {
      <B><FONT COLOR="#228B22">int</FONT></B> result = 1;

      tmp_argv[0][0] = tmp_argv[1][0] = <B><FONT COLOR="#BC8F8F">'\0'</FONT></B>;

      <I><FONT COLOR="#B22222">/* Vérifier argv[] non vide */</FONT></I>
      <B><FONT COLOR="#A020F0">if</FONT></B> (strnotempty(argv[na])) {

        <I><FONT COLOR="#B22222">/* Vérifier Commande (alias) */</FONT></I>
        result =
          optalias_check(argc, (<B><FONT COLOR="#228B22">const</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B> *<B><FONT COLOR="#228B22">const</FONT></B> *) argv, na, &amp;tmp_argc,
                         (<B><FONT COLOR="#228B22">char</FONT></B> **) tmp_argv, tmp_error);
        <B><FONT COLOR="#A020F0">if</FONT></B> (!result) {
          HTS_PANIC_PRINTF(tmp_error);
          htsmain_free();
          <B><FONT COLOR="#A020F0">return</FONT></B> -1;
        }

        <I><FONT COLOR="#B22222">/* Copier */</FONT></I>
        cmdl_add(tmp_argv[0], x_argc, x_argv, x_argvblk, x_ptr);
        <B><FONT COLOR="#A020F0">if</FONT></B> (tmp_argc &gt; 1) {
          cmdl_add(tmp_argv[1], x_argc, x_argv, x_argvblk, x_ptr);
        }

        <I><FONT COLOR="#B22222">/* Compter URLs et détecter -i,-q.. */</FONT></I>
        <B><FONT COLOR="#A020F0">if</FONT></B> (tmp_argc == 1) {    <I><FONT COLOR="#B22222">/* pas -P &amp; co */</FONT></I>
          <B><FONT COLOR="#A020F0">if</FONT></B> (!cmdl_opt(tmp_argv[0])) { <I><FONT COLOR="#B22222">/* pas -c0 &amp; co */</FONT></I>
            <B><FONT COLOR="#A020F0">if</FONT></B> (argv_url &lt; 0)
              argv_url = 0;     <I><FONT COLOR="#B22222">// -1==force -&gt; 1=one url already detected, wipe all previous options
</FONT></I>            <I><FONT COLOR="#B22222">//if (argv_url&gt;=0) {
</FONT></I>            argv_url++;
            <B><FONT COLOR="#A020F0">if</FONT></B> (!argv_firsturl)
              argv_firsturl = x_argv[x_argc - 1];
            <I><FONT COLOR="#B22222">//}
</FONT></I>          } <B><FONT COLOR="#A020F0">else</FONT></B> {
            <B><FONT COLOR="#A020F0">if</FONT></B> (strcmp(tmp_argv[0], <B><FONT COLOR="#BC8F8F">&quot;-h&quot;</FONT></B>) == 0) {
              help(argv[0], !opt-&gt;quiet);
              htsmain_free();
              <B><FONT COLOR="#A020F0">return</FONT></B> 0;
            } <B><FONT COLOR="#A020F0">else</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> (strcmp(tmp_argv[0], <B><FONT COLOR="#BC8F8F">&quot;-#h&quot;</FONT></B>) == 0) {
              printf(<B><FONT COLOR="#BC8F8F">&quot;HTTrack version &quot;</FONT></B> HTTRACK_VERSION <B><FONT COLOR="#BC8F8F">&quot;%s\n&quot;</FONT></B>,
                     hts_get_version_info(opt));
              <B><FONT COLOR="#A020F0">return</FONT></B> 0;
            } <B><FONT COLOR="#A020F0">else</FONT></B> {
              <B><FONT COLOR="#A020F0">if</FONT></B> (strncmp(tmp_argv[0], <B><FONT COLOR="#BC8F8F">&quot;--&quot;</FONT></B>, 2)) {      <I><FONT COLOR="#B22222">/* pas */</FONT></I>
                <B><FONT COLOR="#A020F0">if</FONT></B> ((strchr(tmp_argv[0], <B><FONT COLOR="#BC8F8F">'q'</FONT></B>) != NULL))
                  opt-&gt;quiet = 1;       <I><FONT COLOR="#B22222">// ne pas poser de questions! (nohup par exemple)
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> ((strchr(tmp_argv[0], <B><FONT COLOR="#BC8F8F">'i'</FONT></B>) != NULL)) {       <I><FONT COLOR="#B22222">// doit.log!
</FONT></I>                  argv_url = -1;        <I><FONT COLOR="#B22222">/* forcer */</FONT></I>
                  opt-&gt;quiet = 1;
                }
              } <B><FONT COLOR="#A020F0">else</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> (strcmp(tmp_argv[0] + 2, <B><FONT COLOR="#BC8F8F">&quot;quiet&quot;</FONT></B>) == 0) {
                opt-&gt;quiet = 1; <I><FONT COLOR="#B22222">// ne pas poser de questions! (nohup par exemple)
</FONT></I>              } <B><FONT COLOR="#A020F0">else</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> (strcmp(tmp_argv[0] + 2, <B><FONT COLOR="#BC8F8F">&quot;continue&quot;</FONT></B>) == 0) {
                argv_url = -1;  <I><FONT COLOR="#B22222">/* forcer */</FONT></I>
                opt-&gt;quiet = 1;
              }
            }
          }
        } <B><FONT COLOR="#A020F0">else</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> (tmp_argc == 2) {
          <B><FONT COLOR="#A020F0">if</FONT></B> ((strcmp(tmp_argv[0], <B><FONT COLOR="#BC8F8F">&quot;-%L&quot;</FONT></B>) == 0)) {      <I><FONT COLOR="#B22222">// liste d'URLs
</FONT></I>            <B><FONT COLOR="#A020F0">if</FONT></B> (argv_url &lt; 0)
              argv_url = 0;     <I><FONT COLOR="#B22222">// -1==force -&gt; 1=one url already detected, wipe all previous options
</FONT></I>            <I><FONT COLOR="#B22222">//if (argv_url&gt;=0)
</FONT></I>            argv_url++;         <I><FONT COLOR="#B22222">/* forcer */</FONT></I>
          }
        }
      }

      na += result;
    }
    <B><FONT COLOR="#A020F0">if</FONT></B> (argv_url &lt; 0)
      argv_url = 0;

    <I><FONT COLOR="#B22222">/* Nouveaux argc et argv */</FONT></I>
    argv = x_argv;
    argc = x_argc;
  }

  <I><FONT COLOR="#B22222">// Option O and includerc
</FONT></I>  {
    <B><FONT COLOR="#228B22">int</FONT></B> loops = 0;

    <B><FONT COLOR="#A020F0">while</FONT></B>(loops &lt; 2) {
      <B><FONT COLOR="#228B22">char</FONT></B> *com;
      <B><FONT COLOR="#228B22">int</FONT></B> na;

      <B><FONT COLOR="#A020F0">for</FONT></B>(na = 1; na &lt; argc; na++) {

        <B><FONT COLOR="#A020F0">if</FONT></B> (argv[na][0] == <B><FONT COLOR="#BC8F8F">'&quot;'</FONT></B>) {
          <B><FONT COLOR="#228B22">char</FONT></B> BIGSTK tempo[HTS_CDLMAXSIZE];

          strcpybuff(tempo, argv[na] + 1);
          <B><FONT COLOR="#A020F0">if</FONT></B> (tempo[strlen(tempo) - 1] != <B><FONT COLOR="#BC8F8F">'&quot;'</FONT></B>) {
            <B><FONT COLOR="#228B22">char</FONT></B> BIGSTK s[HTS_CDLMAXSIZE];

            sprintf(s, <B><FONT COLOR="#BC8F8F">&quot;Missing quote in %s&quot;</FONT></B>, argv[na]);
            HTS_PANIC_PRINTF(s);
            htsmain_free();
            <B><FONT COLOR="#A020F0">return</FONT></B> -1;
          }
          tempo[strlen(tempo) - 1] = <B><FONT COLOR="#BC8F8F">'\0'</FONT></B>;
          strcpybuff(argv[na], tempo);
        }

        <B><FONT COLOR="#A020F0">if</FONT></B> (cmdl_opt(argv[na])) {       <I><FONT COLOR="#B22222">// option
</FONT></I>          com = argv[na] + 1;

          <B><FONT COLOR="#A020F0">while</FONT></B>(*com) {
            <B><FONT COLOR="#A020F0">switch</FONT></B> (*com) {
            <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'O'</FONT></B>:          <I><FONT COLOR="#B22222">// output path
</FONT></I>              <B><FONT COLOR="#A020F0">if</FONT></B> ((na + 1 &gt;= argc) || (argv[na + 1][0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>)) {
                HTS_PANIC_PRINTF
                  (<B><FONT COLOR="#BC8F8F">&quot;Option O needs to be followed by a blank space, and a path (or path,path)&quot;</FONT></B>);
                printf(<B><FONT COLOR="#BC8F8F">&quot;Example: -O /binary/\n&quot;</FONT></B>);
                printf(<B><FONT COLOR="#BC8F8F">&quot;Example: -O /binary/,/log/\n&quot;</FONT></B>);
                htsmain_free();
                <B><FONT COLOR="#A020F0">return</FONT></B> -1;
              } <B><FONT COLOR="#A020F0">else</FONT></B> {
                <B><FONT COLOR="#228B22">int</FONT></B> i <I><FONT COLOR="#B22222">/*, j */</FONT></I> ;
                <B><FONT COLOR="#228B22">int</FONT></B> inQuote;
                String *path;
                <B><FONT COLOR="#228B22">int</FONT></B> noDbl = 0;

                <B><FONT COLOR="#A020F0">if</FONT></B> (com[1] == <B><FONT COLOR="#BC8F8F">'1'</FONT></B>) {    <I><FONT COLOR="#B22222">/* only 1 arg */</FONT></I>
                  com++;
                  noDbl = 1;
                }
                na++;
                StringClear(opt-&gt;path_html);
                StringClear(opt-&gt;path_log);
                <B><FONT COLOR="#A020F0">for</FONT></B>(i = 0 <I><FONT COLOR="#B22222">/*, j = 0 */</FONT></I> , inQuote = 0, path = &amp;opt-&gt;path_html;
                    argv[na][i] != 0; i++) {
                  <B><FONT COLOR="#A020F0">if</FONT></B> (argv[na][i] == <B><FONT COLOR="#BC8F8F">'&quot;'</FONT></B>) {
                    <B><FONT COLOR="#A020F0">if</FONT></B> (inQuote)
                      inQuote = 0;
                    <B><FONT COLOR="#A020F0">else</FONT></B>
                      inQuote = 1;
                  } <B><FONT COLOR="#A020F0">else</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> (!inQuote &amp;&amp; !noDbl &amp;&amp; argv[na][i] == <B><FONT COLOR="#BC8F8F">','</FONT></B>) {
                    <I><FONT COLOR="#B22222">//StringAddchar(path, '\0');
</FONT></I>                    <I><FONT COLOR="#B22222">//j = 0;
</FONT></I>                    path = &amp;opt-&gt;path_log;
                  } <B><FONT COLOR="#A020F0">else</FONT></B> {
                    StringAddchar(*path, argv[na][i]);
                    <I><FONT COLOR="#B22222">//path[j++] = argv[na][i];
</FONT></I>                  }
                }
                <I><FONT COLOR="#B22222">//path[j++] = '\0';
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> (StringLength(opt-&gt;path_log) == 0) {
                  StringCopyS(opt-&gt;path_log, opt-&gt;path_html);
                }

                check_path(&amp;opt-&gt;path_log, argv_firsturl);
                <B><FONT COLOR="#A020F0">if</FONT></B> (check_path(&amp;opt-&gt;path_html, argv_firsturl)) {
                  opt-&gt;dir_topindex = 1;        <I><FONT COLOR="#B22222">// rebuilt top index
</FONT></I>                }
                <I><FONT COLOR="#B22222">//printf(&quot;--&gt;%s\n%s\n&quot;,StringBuff(opt-&gt;path_html),StringBuff(opt-&gt;path_log));                
</FONT></I>              }
              <B><FONT COLOR="#A020F0">break</FONT></B>;
            }                   <I><FONT COLOR="#B22222">// switch
</FONT></I>            com++;
          }                     <I><FONT COLOR="#B22222">// while
</FONT></I>
        }                       <I><FONT COLOR="#B22222">// arg
</FONT></I>
      }                         <I><FONT COLOR="#B22222">// for
</FONT></I>
      <I><FONT COLOR="#B22222">// Convert path to UTF-8
</FONT></I>#<B><FONT COLOR="#5F9EA0">ifdef</FONT></B> <FONT COLOR="#B8860B">_WIN32</FONT>
      {
        <B><FONT COLOR="#228B22">char</FONT></B> *<B><FONT COLOR="#228B22">const</FONT></B> path =
          hts_convertStringSystemToUTF8(StringBuff(opt-&gt;path_html),
                                        (<B><FONT COLOR="#228B22">int</FONT></B>) StringLength(opt-&gt;path_html));
        <B><FONT COLOR="#A020F0">if</FONT></B> (path != NULL) {
          StringCopy(opt-&gt;path_html_utf8, path);
          free(path);
        } <B><FONT COLOR="#A020F0">else</FONT></B> {
          StringCopyN(opt-&gt;path_html_utf8, StringBuff(opt-&gt;path_html),
                      StringLength(opt-&gt;path_html));
        }
      }
#<B><FONT COLOR="#5F9EA0">else</FONT></B>
      <I><FONT COLOR="#B22222">// Assume UTF-8 filesystem.
</FONT></I>      StringCopyN(opt-&gt;path_html_utf8, StringBuff(opt-&gt;path_html),
                  StringLength(opt-&gt;path_html));
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>

      <I><FONT COLOR="#B22222">/* if doit.log exists, or if new URL(s) defined, 
         then DO NOT load standard config files */</FONT></I>
      <I><FONT COLOR="#B22222">/* (config files are added in doit.log) */</FONT></I>
#<B><FONT COLOR="#5F9EA0">if</FONT></B> <FONT COLOR="#B8860B">DEBUG_STEPS</FONT>
      printf(<B><FONT COLOR="#BC8F8F">&quot;Loading httrackrc/doit.log\n&quot;</FONT></B>);
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
      <I><FONT COLOR="#B22222">/* recreate a doit.log (no old doit.log or new URLs (and parameters)) */</FONT></I>
      <B><FONT COLOR="#A020F0">if</FONT></B> ((strnotempty(StringBuff(opt-&gt;path_log)))
          || (strnotempty(StringBuff(opt-&gt;path_html))))
        loops++;                <I><FONT COLOR="#B22222">// do not loop once again and do not include rc file (O option exists)
</FONT></I>      <B><FONT COLOR="#A020F0">else</FONT></B> {
        <B><FONT COLOR="#A020F0">if</FONT></B> ((!fexist
             (fconcat
              (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
              StringBuff(opt-&gt;path_log),
               <B><FONT COLOR="#BC8F8F">&quot;hts-cache/doit.log&quot;</FONT></B>))) || (argv_url &gt; 0)) {
          <B><FONT COLOR="#A020F0">if</FONT></B> (!optinclude_file
              (fconcat
               (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
               StringBuff(opt-&gt;path_log), HTS_HTTRACKRC),
               &amp;argc, argv, x_argvblk, &amp;x_ptr))
            <B><FONT COLOR="#A020F0">if</FONT></B> (!optinclude_file(HTS_HTTRACKRC, &amp;argc, argv, x_argvblk, &amp;x_ptr)) {
              <B><FONT COLOR="#A020F0">if</FONT></B> (!optinclude_file
                  (fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
                  hts_gethome(), <B><FONT COLOR="#BC8F8F">&quot;/&quot;</FONT></B> HTS_HTTRACKRC),
                   &amp;argc, argv, x_argvblk, &amp;x_ptr)) {
#<B><FONT COLOR="#5F9EA0">ifdef</FONT></B> <FONT COLOR="#B8860B">HTS_HTTRACKCNF</FONT>
                optinclude_file(HTS_HTTRACKCNF, &amp;argc, argv, x_argvblk, &amp;x_ptr);
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
              }
            }
        } <B><FONT COLOR="#A020F0">else</FONT></B>
          loops++;              <I><FONT COLOR="#B22222">// do not loop once again
</FONT></I>      }

      loops++;
    }                           <I><FONT COLOR="#B22222">// while
</FONT></I>
  }                             <I><FONT COLOR="#B22222">// traiter -O
</FONT></I>
  <I><FONT COLOR="#B22222">/* load doit.log and insert in current command line */</FONT></I>
  <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
      (fconcat
       (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
       StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-cache/doit.log&quot;</FONT></B>))
      &amp;&amp; (argv_url &lt;= 0)) {
    FILE *fp =
      fopen(fconcat
            (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
            StringBuff(opt-&gt;path_log),
             <B><FONT COLOR="#BC8F8F">&quot;hts-cache/doit.log&quot;</FONT></B>), <B><FONT COLOR="#BC8F8F">&quot;rb&quot;</FONT></B>);
    <B><FONT COLOR="#A020F0">if</FONT></B> (fp) {
      <B><FONT COLOR="#228B22">int</FONT></B> insert_after = 1;     <I><FONT COLOR="#B22222">/* insérer après nom au début */</FONT></I>

      <I><FONT COLOR="#B22222">//
</FONT></I>      <B><FONT COLOR="#228B22">char</FONT></B> BIGSTK buff[8192];
      <B><FONT COLOR="#228B22">char</FONT></B> *p, *lastp;

      linput(fp, buff, 8000);
      fclose(fp);
      fp = NULL;
      p = buff;
      <B><FONT COLOR="#A020F0">do</FONT></B> {
        <B><FONT COLOR="#228B22">int</FONT></B> insert_after_argc;

        <I><FONT COLOR="#B22222">// read next
</FONT></I>        lastp = p;
        <B><FONT COLOR="#A020F0">if</FONT></B> (p) {
          p = next_token(p, 1);
          <B><FONT COLOR="#A020F0">if</FONT></B> (p) {
            *p = 0;             <I><FONT COLOR="#B22222">// null
</FONT></I>            p++;
          }
        }

        <I><FONT COLOR="#B22222">/* Insert parameters BUT so that they can be in the same order */</FONT></I>
        <B><FONT COLOR="#A020F0">if</FONT></B> (lastp) {
          <B><FONT COLOR="#A020F0">if</FONT></B> (strnotempty(lastp)) {
            insert_after_argc = argc - insert_after;
            cmdl_ins(lastp, insert_after_argc, (argv + insert_after), x_argvblk,
                     x_ptr);
            argc = insert_after_argc + insert_after;
            insert_after++;
          }
        }
      } <B><FONT COLOR="#A020F0">while</FONT></B>(lastp != NULL);
      <I><FONT COLOR="#B22222">//fclose(fp);
</FONT></I>    }
  }

  <I><FONT COLOR="#B22222">// Existence d'un cache - pas de new mais un old.. renommer
</FONT></I>#<B><FONT COLOR="#5F9EA0">if</FONT></B> <FONT COLOR="#B8860B">DEBUG_STEPS</FONT>
  printf(<B><FONT COLOR="#BC8F8F">&quot;Checking cache\n&quot;</FONT></B>);
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
  <B><FONT COLOR="#A020F0">if</FONT></B> (!fexist
      (fconcat
       (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
       StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.zip&quot;</FONT></B>))) {
    <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
        (fconcat
         (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
         StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.zip&quot;</FONT></B>))) {
      rename(fconcat
             (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
             StringBuff(opt-&gt;path_log),
              <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.zip&quot;</FONT></B>), fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
                                            StringBuff(opt-&gt;path_log),
                                            <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.zip&quot;</FONT></B>));
    }
  } <B><FONT COLOR="#A020F0">else</FONT></B>
    <B><FONT COLOR="#A020F0">if</FONT></B> ((!fexist
         (fconcat
          (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
          StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.dat&quot;</FONT></B>)))
        ||
        (!fexist
         (fconcat
          (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
          StringBuff(opt-&gt;path_log),
           <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.ndx&quot;</FONT></B>)))) {
    <B><FONT COLOR="#A020F0">if</FONT></B> ((fexist
         (fconcat
          (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
          StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.dat&quot;</FONT></B>)))
        &amp;&amp;
        (fexist
         (fconcat
          (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
          StringBuff(opt-&gt;path_log),
           <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.ndx&quot;</FONT></B>)))) {
      remove(fconcat
             (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
             StringBuff(opt-&gt;path_log),
              <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.dat&quot;</FONT></B>));
      remove(fconcat
             (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
             StringBuff(opt-&gt;path_log),
              <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.ndx&quot;</FONT></B>));
      <I><FONT COLOR="#B22222">//remove(fconcat(StringBuff(opt-&gt;path_log),&quot;hts-cache/new.lst&quot;));
</FONT></I>      rename(fconcat
             (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
             StringBuff(opt-&gt;path_log),
              <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.dat&quot;</FONT></B>), fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
                                            StringBuff(opt-&gt;path_log),
                                            <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.dat&quot;</FONT></B>));
      rename(fconcat
             (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
              <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.ndx&quot;</FONT></B>), fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
                                            StringBuff(opt-&gt;path_log),
                                            <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.ndx&quot;</FONT></B>));
      <I><FONT COLOR="#B22222">//rename(fconcat(StringBuff(opt-&gt;path_log),&quot;hts-cache/old.lst&quot;),fconcat(StringBuff(opt-&gt;path_log),&quot;hts-cache/new.lst&quot;));
</FONT></I>    }
  }

  <I><FONT COLOR="#B22222">/* Interrupted mirror detected */</FONT></I>
  <B><FONT COLOR="#A020F0">if</FONT></B> (!opt-&gt;quiet) {
    <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
        (fconcat
         (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
         StringBuff(opt-&gt;path_log),
          <B><FONT COLOR="#BC8F8F">&quot;hts-in_progress.lock&quot;</FONT></B>))) {
      <I><FONT COLOR="#B22222">/* Old cache */</FONT></I>
      <B><FONT COLOR="#A020F0">if</FONT></B> ((fexist
           (fconcat
            (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
            StringBuff(opt-&gt;path_log),
             <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.dat&quot;</FONT></B>)))
          &amp;&amp;
          (fexist
           (fconcat
            (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
            StringBuff(opt-&gt;path_log),
             <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.ndx&quot;</FONT></B>)))) {
        <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;log != NULL) {
          fprintf(opt-&gt;log, <B><FONT COLOR="#BC8F8F">&quot;Warning!\n&quot;</FONT></B>);
          fprintf(opt-&gt;log,
                  <B><FONT COLOR="#BC8F8F">&quot;An aborted mirror has been detected!\nThe current temporary cache is required for any update operation and only contains data downloaded during the last aborted session.\nThe former cache might contain more complete information; if you do not want to lose that information, you have to restore it and delete the current cache.\nThis can easily be done here by erasing the hts-cache/new.* files\n&quot;</FONT></B>);
          fprintf(opt-&gt;log,
                  <B><FONT COLOR="#BC8F8F">&quot;Please restart HTTrack with --continue (-iC1) option to override this message!\n&quot;</FONT></B>);
        }
        <B><FONT COLOR="#A020F0">return</FONT></B> 0;
      }
    }
  }
  <I><FONT COLOR="#B22222">// remplacer &quot;macros&quot; comme --spider
</FONT></I>  <I><FONT COLOR="#B22222">// permet de lancer httrack sans a avoir à se rappeler de syntaxes comme p0C0I0Qc32 ..
</FONT></I>#<B><FONT COLOR="#5F9EA0">if</FONT></B> <FONT COLOR="#B8860B">DEBUG_STEPS</FONT>
  printf(<B><FONT COLOR="#BC8F8F">&quot;Checking last macros\n&quot;</FONT></B>);
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
  {
    <B><FONT COLOR="#228B22">int</FONT></B> i;

    <B><FONT COLOR="#A020F0">for</FONT></B>(i = 0; i &lt; argc; i++) {
#<B><FONT COLOR="#5F9EA0">if</FONT></B> <FONT COLOR="#B8860B">DEBUG_STEPS</FONT>
      printf(<B><FONT COLOR="#BC8F8F">&quot;Checking #%d:\n&quot;</FONT></B>, argv[i]);
      printf(<B><FONT COLOR="#BC8F8F">&quot;%s\n&quot;</FONT></B>, argv[i]);
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
      <B><FONT COLOR="#A020F0">if</FONT></B> (argv[i][0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>) {
        <B><FONT COLOR="#A020F0">if</FONT></B> (argv[i][1] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>) {        <I><FONT COLOR="#B22222">// --xxx
</FONT></I>          <B><FONT COLOR="#A020F0">if</FONT></B> ((strfield2(argv[i] + 2, <B><FONT COLOR="#BC8F8F">&quot;clean&quot;</FONT></B>)) || (strfield2(argv[i] + 2, <B><FONT COLOR="#BC8F8F">&quot;tide&quot;</FONT></B>))) {  <I><FONT COLOR="#B22222">// nettoyer
</FONT></I>            strcpybuff(argv[i] + 1, <B><FONT COLOR="#BC8F8F">&quot;&quot;</FONT></B>);
            <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
                (fconcat
                 (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-log.txt&quot;</FONT></B>)))
              remove(fconcat
                     (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                      <B><FONT COLOR="#BC8F8F">&quot;hts-log.txt&quot;</FONT></B>));
            <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
                (fconcat
                 (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-err.txt&quot;</FONT></B>)))
              remove(fconcat
                     (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                      <B><FONT COLOR="#BC8F8F">&quot;hts-err.txt&quot;</FONT></B>));
            <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
                (fconcat
                 (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_html), <B><FONT COLOR="#BC8F8F">&quot;index.html&quot;</FONT></B>)))
              remove(fconcat
                     (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_html),
                      <B><FONT COLOR="#BC8F8F">&quot;index.html&quot;</FONT></B>));
            <I><FONT COLOR="#B22222">/* */</FONT></I>
            <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
                (fconcat
                 (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                  <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.zip&quot;</FONT></B>)))
              remove(fconcat
                     (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                      <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.zip&quot;</FONT></B>));
            <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
                (fconcat
                 (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                  <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.zip&quot;</FONT></B>)))
              remove(fconcat
                     (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                      <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.zip&quot;</FONT></B>));
            <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
                (fconcat
                 (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                  <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.dat&quot;</FONT></B>)))
              remove(fconcat
                     (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                      <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.dat&quot;</FONT></B>));
            <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
                (fconcat
                 (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                  <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.ndx&quot;</FONT></B>)))
              remove(fconcat
                     (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                      <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.ndx&quot;</FONT></B>));
            <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
                (fconcat
                 (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                  <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.dat&quot;</FONT></B>)))
              remove(fconcat
                     (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                      <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.dat&quot;</FONT></B>));
            <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
                (fconcat
                 (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                  <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.ndx&quot;</FONT></B>)))
              remove(fconcat
                     (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                      <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.ndx&quot;</FONT></B>));
            <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
                (fconcat
                 (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                  <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.lst&quot;</FONT></B>)))
              remove(fconcat
                     (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                      <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.lst&quot;</FONT></B>));
            <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
                (fconcat
                 (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                  <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.lst&quot;</FONT></B>)))
              remove(fconcat
                     (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                      <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.lst&quot;</FONT></B>));
            <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
                (fconcat
                 (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                  <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.txt&quot;</FONT></B>)))
              remove(fconcat
                     (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                      <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.txt&quot;</FONT></B>));
            <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
                (fconcat
                 (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                  <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.txt&quot;</FONT></B>)))
              remove(fconcat
                     (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                      <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.txt&quot;</FONT></B>));
            <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
                (fconcat
                 (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                  <B><FONT COLOR="#BC8F8F">&quot;hts-cache/doit.log&quot;</FONT></B>)))
              remove(fconcat
                     (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                      <B><FONT COLOR="#BC8F8F">&quot;hts-cache/doit.log&quot;</FONT></B>));
            <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
                (fconcat
                 (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                  <B><FONT COLOR="#BC8F8F">&quot;hts-in_progress.lock&quot;</FONT></B>)))
              remove(fconcat
                     (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                      <B><FONT COLOR="#BC8F8F">&quot;hts-in_progress.lock&quot;</FONT></B>));
            rmdir(fconcat
                  (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-cache&quot;</FONT></B>));
            <I><FONT COLOR="#B22222">//
</FONT></I>          } <B><FONT COLOR="#A020F0">else</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> (strfield2(argv[i] + 2, <B><FONT COLOR="#BC8F8F">&quot;catchurl&quot;</FONT></B>)) {      <I><FONT COLOR="#B22222">// capture d'URL via proxy temporaire!
</FONT></I>            argv_url = 1;       <I><FONT COLOR="#B22222">// forcer a passer les parametres
</FONT></I>            strcpybuff(argv[i] + 1, <B><FONT COLOR="#BC8F8F">&quot;#P&quot;</FONT></B>);
            <I><FONT COLOR="#B22222">//
</FONT></I>          } <B><FONT COLOR="#A020F0">else</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> (strfield2(argv[i] + 2, <B><FONT COLOR="#BC8F8F">&quot;updatehttrack&quot;</FONT></B>)) {
#<B><FONT COLOR="#5F9EA0">ifdef</FONT></B> <FONT COLOR="#B8860B">_WIN32</FONT>
            <B><FONT COLOR="#228B22">char</FONT></B> s[HTS_CDLMAXSIZE + 256];

            sprintf(s, <B><FONT COLOR="#BC8F8F">&quot;%s not available in this version&quot;</FONT></B>, argv[i]);
            HTS_PANIC_PRINTF(s);
            htsmain_free();
            <B><FONT COLOR="#A020F0">return</FONT></B> -1;
#<B><FONT COLOR="#5F9EA0">else</FONT></B>
#<B><FONT COLOR="#5F9EA0">if</FONT></B> 0
            <B><FONT COLOR="#228B22">char</FONT></B> _args[8][256];
            <B><FONT COLOR="#228B22">char</FONT></B> *args[8];

            printf(<B><FONT COLOR="#BC8F8F">&quot;Cheking for updates...\n&quot;</FONT></B>);
            strcpybuff(_args[0], argv[0]);
            strcpybuff(_args[1], <B><FONT COLOR="#BC8F8F">&quot;--get&quot;</FONT></B>);
            sprintf(_args[2], HTS_UPDATE_WEBSITE, 0, <B><FONT COLOR="#BC8F8F">&quot;&quot;</FONT></B>);
            strcpybuff(_args[3], <B><FONT COLOR="#BC8F8F">&quot;--quickinfo&quot;</FONT></B>);
            args[0] = _args[0];
            args[1] = _args[1];
            args[2] = _args[2];
            args[3] = _args[3];
            args[4] = NULL;
            <B><FONT COLOR="#A020F0">if</FONT></B> (execvp(args[0], args) == -1) {
            }
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
          }
          <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">else</FONT></B> {
            <B><FONT COLOR="#228B22">char</FONT></B> s[HTS_CDLMAXSIZE + 256];

            sprintf(s, <B><FONT COLOR="#BC8F8F">&quot;%s not recognized&quot;</FONT></B>, argv[i]);
            HTS_PANIC_PRINTF(s);
            htsmain_free();
            <B><FONT COLOR="#A020F0">return</FONT></B> -1;
          }

        }
      }
    }
  }

  <I><FONT COLOR="#B22222">// Compter urls/jokers
</FONT></I>  <I><FONT COLOR="#B22222">/*
     if (argv_url&lt;=0) { 
     int na;
     argv_url=0;
     for(na=1;na&lt;argc;na++) {
     if ( (strcmp(argv[na],&quot;-P&quot;)==0) || (strcmp(argv[na],&quot;-N&quot;)==0) || (strcmp(argv[na],&quot;-F&quot;)==0) || (strcmp(argv[na],&quot;-O&quot;)==0) || (strcmp(argv[na],&quot;-V&quot;)==0) ) {
     na++;    // sauter nom de proxy
     } else if (!cmdl_opt(argv[na])) { 
     argv_url++;   // un de plus       
     } else if (strcmp(argv[na],&quot;-h&quot;)==0) {
     help(argv[0],!opt-&gt;quiet);
     htsmain_free();
     return 0;
     } else {
     if ((strchr(argv[na],'q')!=NULL))
     opt-&gt;quiet=1;    // ne pas poser de questions! (nohup par exemple)
     if ((strchr(argv[na],'i')!=NULL)) {  // doit.log!
     argv_url=0;
     na=argc;
     }
     }
     }
     }  
   */</FONT></I>

  <I><FONT COLOR="#B22222">// Ici on ajoute les arguments qui ont été appelés avant au cas où on récupère une session
</FONT></I>  <I><FONT COLOR="#B22222">// Exemple: httrack www.truc.fr -L0 puis ^C puis httrack sans URL : ajouter URL précédente
</FONT></I>  <I><FONT COLOR="#B22222">/*
     if (argv_url==0) {
     //if ((fexist(fconcat(StringBuff(opt-&gt;path_log),&quot;hts-cache/new.dat&quot;))) &amp;&amp; (fexist(fconcat(StringBuff(opt-&gt;path_log),&quot;hts-cache/new.ndx&quot;)))) {  // il existe déja un cache précédent.. renommer
     if (fexist(fconcat(StringBuff(opt-&gt;path_log),&quot;hts-cache/doit.log&quot;))) {    // un cache est présent

     x_argvblk=(char*) calloct(32768,1);

     if (x_argvblk!=NULL) {
     FILE* fp;
     int x_argc;

     //strcpybuff(x_argvblk,&quot;httrack &quot;);
     fp=fopen(fconcat(StringBuff(opt-&gt;path_log),&quot;hts-cache/doit.log&quot;),&quot;rb&quot;);
     if (fp) {
     linput(fp,x_argvblk+strlen(x_argvblk),8192);
     fclose(fp); fp=NULL;
     }

     // calculer arguments selon derniers arguments
     x_argv[0]=argv[0];
     x_argc=1;
     {
     char* p=x_argvblk;
     do {
     x_argv[x_argc++]=p;
     //p=strstr(p,&quot; &quot;);
     // exemple de chaine: &quot;echo \&quot;test\&quot;&quot; c:\a &quot;\$0&quot;
     p=next_token(p,1);    // prochain token
     if (p) {
     *p=0;    // octet nul (tableau)
     p++;
     }            
     } while(p!=NULL);
     }
     // recopier arguments actuels (pointeurs uniquement)
     {
     int na;
     for(na=1;na&lt;argc;na++) {
     if (strcmp(argv[na],&quot;-O&quot;) != 0)    // SAUF le path!
     x_argv[x_argc++]=argv[na];
     else
     na++;
     }
     }
     argc=x_argc;      // nouvel argc
     argv=x_argv;      // nouvel argv
     }

     }
     //}
     }
   */</FONT></I>

  <I><FONT COLOR="#B22222">// Vérifier quiet
</FONT></I>  <I><FONT COLOR="#B22222">/*
     { 
     int na;    
     for(na=1;na&lt;argc;na++) {
     if (!cmdl_opt(argv[na])) { 
     if ((strcmp(argv[na],&quot;-P&quot;)==0) || (strcmp(argv[na],&quot;-N&quot;)==0) || (strcmp(argv[na],&quot;-F&quot;)==0) || (strcmp(argv[na],&quot;-O&quot;)==0) || (strcmp(argv[na],&quot;-V&quot;)==0))
     na++;    // sauter nom de proxy
     } else {
     if ((strchr(argv[na],'q')!=NULL) || (strchr(argv[na],'i')!=NULL))
     opt-&gt;quiet=1;    // ne pas poser de questions! (nohup par exemple)
     }
     }
     }
   */</FONT></I>

  <I><FONT COLOR="#B22222">// Pas d'URL
</FONT></I>#<B><FONT COLOR="#5F9EA0">if</FONT></B> <FONT COLOR="#B8860B">DEBUG_STEPS</FONT>
  printf(<B><FONT COLOR="#BC8F8F">&quot;Checking URLs\n&quot;</FONT></B>);
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
  <B><FONT COLOR="#A020F0">if</FONT></B> (argv_url == 0) {
    <I><FONT COLOR="#B22222">// Présence d'un cache, que faire?..
</FONT></I>    <B><FONT COLOR="#A020F0">if</FONT></B> ((fexist
         (fconcat
          (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), 
          StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.zip&quot;</FONT></B>)))
        ||
        (fexist
         (fconcat
          (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), 
          StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.dat&quot;</FONT></B>))
         &amp;&amp;
         fexist(fconcat
                (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
                StringBuff(opt-&gt;path_log),
                 <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.ndx&quot;</FONT></B>)))
      ) {                       <I><FONT COLOR="#B22222">// il existe déja un cache précédent.. renommer
</FONT></I>      <B><FONT COLOR="#A020F0">if</FONT></B> (fexist(fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
        StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-cache/doit.log&quot;</FONT></B>))) {        <I><FONT COLOR="#B22222">// un cache est présent
</FONT></I>        <B><FONT COLOR="#A020F0">if</FONT></B> (x_argvblk != NULL) {
          <B><FONT COLOR="#228B22">int</FONT></B> m;

          <I><FONT COLOR="#B22222">// établir mode - mode cache: 1 (cache valide) 2 (cache à vérifier)
</FONT></I>          <B><FONT COLOR="#A020F0">if</FONT></B> (fexist(fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
            StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-in_progress.lock&quot;</FONT></B>))) {  <I><FONT COLOR="#B22222">// cache prioritaire
</FONT></I>            m = 1;
          } <B><FONT COLOR="#A020F0">else</FONT></B> {
            m = 2;
          }
          opt-&gt;cache = m;

          <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;quiet == 0) {        <I><FONT COLOR="#B22222">// sinon on continue automatiquement
</FONT></I>            HT_REQUEST_START;
            HT_PRINT(<B><FONT COLOR="#BC8F8F">&quot;A cache (hts-cache/) has been found in the directory &quot;</FONT></B>);
            HT_PRINT(StringBuff(opt-&gt;path_log));
            HT_PRINT(LF);
            <B><FONT COLOR="#A020F0">if</FONT></B> (m == 1) {
              HT_PRINT(<B><FONT COLOR="#BC8F8F">&quot;That means that a transfer has been aborted&quot;</FONT></B> LF);
              HT_PRINT(<B><FONT COLOR="#BC8F8F">&quot;OK to Continue &quot;</FONT></B>);
            } <B><FONT COLOR="#A020F0">else</FONT></B> {
              HT_PRINT(<B><FONT COLOR="#BC8F8F">&quot;That means you can update faster the remote site(s)&quot;</FONT></B>
                       LF);
              HT_PRINT(<B><FONT COLOR="#BC8F8F">&quot;OK to Update &quot;</FONT></B>);
            }
            HT_PRINT(<B><FONT COLOR="#BC8F8F">&quot;httrack &quot;</FONT></B>);
            HT_PRINT(x_argvblk);
            HT_PRINT(<B><FONT COLOR="#BC8F8F">&quot;?&quot;</FONT></B> LF);
            HT_REQUEST_END;
            <B><FONT COLOR="#A020F0">if</FONT></B> (!ask_continue(opt)) {
              htsmain_free();
              <B><FONT COLOR="#A020F0">return</FONT></B> 0;
            }
          }

        } <B><FONT COLOR="#A020F0">else</FONT></B> {
          HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;Error, not enough memory&quot;</FONT></B>);
          htsmain_free();
          <B><FONT COLOR="#A020F0">return</FONT></B> -1;
        }
      } <B><FONT COLOR="#A020F0">else</FONT></B> {                  <I><FONT COLOR="#B22222">// log existe pas
</FONT></I>        HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;A cache has been found, but no command line&quot;</FONT></B>);
        printf
          (<B><FONT COLOR="#BC8F8F">&quot;Please launch httrack with proper parameters to reuse the cache\n&quot;</FONT></B>);
        htsmain_free();
        <B><FONT COLOR="#A020F0">return</FONT></B> -1;
      }

    } <B><FONT COLOR="#A020F0">else</FONT></B> {                    <I><FONT COLOR="#B22222">// aucune URL définie et pas de cache
</FONT></I>      <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;quiet) {
        help(argv[0], !opt-&gt;quiet);
        htsmain_free();
        <B><FONT COLOR="#A020F0">return</FONT></B> -1;
      } <B><FONT COLOR="#A020F0">else</FONT></B> {
        help_wizard(opt);
        htsmain_free();
        <B><FONT COLOR="#A020F0">return</FONT></B> -1;
      }
      htsmain_free();
      <B><FONT COLOR="#A020F0">return</FONT></B> 0;
    }
  } <B><FONT COLOR="#A020F0">else</FONT></B> {                      <I><FONT COLOR="#B22222">// plus de 2 paramètres
</FONT></I>    <I><FONT COLOR="#B22222">// un fichier log existe?
</FONT></I>    <B><FONT COLOR="#A020F0">if</FONT></B> (fexist(fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
      StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-in_progress.lock&quot;</FONT></B>))) {        <I><FONT COLOR="#B22222">// fichier lock?
</FONT></I>      <I><FONT COLOR="#B22222">//char s[32];
</FONT></I>
      opt-&gt;cache = 1;           <I><FONT COLOR="#B22222">// cache prioritaire
</FONT></I>      <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;quiet == 0) {
        <B><FONT COLOR="#A020F0">if</FONT></B> ((fexist
             (fconcat
              (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
               <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.zip&quot;</FONT></B>)))
            ||
            (fexist
             (fconcat
              (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
               <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.dat&quot;</FONT></B>))
             &amp;&amp;
             fexist(fconcat
                    (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                     <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.ndx&quot;</FONT></B>)))
          ) {
          HT_REQUEST_START;
          HT_PRINT(<B><FONT COLOR="#BC8F8F">&quot;There is a lock-file in the directory &quot;</FONT></B>);
          HT_PRINT(StringBuff(opt-&gt;path_log));
          HT_PRINT(LF <B><FONT COLOR="#BC8F8F">&quot;That means that a mirror has not been terminated&quot;</FONT></B> LF);
          HT_PRINT(<B><FONT COLOR="#BC8F8F">&quot;Be sure you call httrack with proper parameters&quot;</FONT></B> LF);
          HT_PRINT(<B><FONT COLOR="#BC8F8F">&quot;(The cache allows you to restart faster the transfer)&quot;</FONT></B> LF);
          HT_REQUEST_END;
          <B><FONT COLOR="#A020F0">if</FONT></B> (!ask_continue(opt)) {
            htsmain_free();
            <B><FONT COLOR="#A020F0">return</FONT></B> 0;
          }
        }
      }
    } <B><FONT COLOR="#A020F0">else</FONT></B>
      <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
          (fconcat
           (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_html), <B><FONT COLOR="#BC8F8F">&quot;index.html&quot;</FONT></B>))) {
      <I><FONT COLOR="#B22222">//char s[32];
</FONT></I>      opt-&gt;cache = 2;           <I><FONT COLOR="#B22222">// cache vient après test de validité
</FONT></I>      <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;quiet == 0) {
        <B><FONT COLOR="#A020F0">if</FONT></B> ((fexist
             (fconcat
              (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
               <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.zip&quot;</FONT></B>)))
            ||
            (fexist
             (fconcat
              (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
               <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.dat&quot;</FONT></B>))
             &amp;&amp;
             fexist(fconcat
                    (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                     <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.ndx&quot;</FONT></B>)))
          ) {
          HT_REQUEST_START;
          HT_PRINT
            (<B><FONT COLOR="#BC8F8F">&quot;There is an index.html and a hts-cache folder in the directory &quot;</FONT></B>);
          HT_PRINT(StringBuff(opt-&gt;path_log));
          HT_PRINT(LF
                   <B><FONT COLOR="#BC8F8F">&quot;A site may have been mirrored here, that could mean that you want to update it&quot;</FONT></B>
                   LF);
          HT_PRINT(<B><FONT COLOR="#BC8F8F">&quot;Be sure parameters are ok&quot;</FONT></B> LF);
          HT_REQUEST_END;
          <B><FONT COLOR="#A020F0">if</FONT></B> (!ask_continue(opt)) {
            htsmain_free();
            <B><FONT COLOR="#A020F0">return</FONT></B> 0;
          }
        } <B><FONT COLOR="#A020F0">else</FONT></B> {
          HT_REQUEST_START;
          HT_PRINT(<B><FONT COLOR="#BC8F8F">&quot;There is an index.html in the directory &quot;</FONT></B>);
          HT_PRINT(StringBuff(opt-&gt;path_log));
          HT_PRINT(<B><FONT COLOR="#BC8F8F">&quot; but no cache&quot;</FONT></B> LF);
          HT_PRINT(<B><FONT COLOR="#BC8F8F">&quot;There is an index.html in the directory, but no cache&quot;</FONT></B> LF);
          HT_PRINT(<B><FONT COLOR="#BC8F8F">&quot;A site may have been mirrored here, and erased..&quot;</FONT></B> LF);
          HT_PRINT(<B><FONT COLOR="#BC8F8F">&quot;Be sure parameters are ok&quot;</FONT></B> LF);
          HT_REQUEST_END;
          <B><FONT COLOR="#A020F0">if</FONT></B> (!ask_continue(opt)) {
            htsmain_free();
            <B><FONT COLOR="#A020F0">return</FONT></B> 0;
          }
        }
      }
    }
  }

  <I><FONT COLOR="#B22222">// Treat parameters
</FONT></I>  <I><FONT COLOR="#B22222">// Traiter les paramètres
</FONT></I>#<B><FONT COLOR="#5F9EA0">if</FONT></B> <FONT COLOR="#B8860B">DEBUG_STEPS</FONT>
  printf(<B><FONT COLOR="#BC8F8F">&quot;Analyze parameters\n&quot;</FONT></B>);
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
  {
    <B><FONT COLOR="#228B22">char</FONT></B> *com;
    <B><FONT COLOR="#228B22">int</FONT></B> na;

    <B><FONT COLOR="#A020F0">for</FONT></B>(na = 1; na &lt; argc; na++) {

      <B><FONT COLOR="#A020F0">if</FONT></B> (argv[na][0] == <B><FONT COLOR="#BC8F8F">'&quot;'</FONT></B>) {
        <B><FONT COLOR="#228B22">char</FONT></B> BIGSTK tempo[HTS_CDLMAXSIZE + 256];

        strcpybuff(tempo, argv[na] + 1);
        <B><FONT COLOR="#A020F0">if</FONT></B> (tempo[strlen(tempo) - 1] != <B><FONT COLOR="#BC8F8F">'&quot;'</FONT></B>) {
          <B><FONT COLOR="#228B22">char</FONT></B> s[HTS_CDLMAXSIZE + 256];

          sprintf(s, <B><FONT COLOR="#BC8F8F">&quot;Missing quote in %s&quot;</FONT></B>, argv[na]);
          HTS_PANIC_PRINTF(s);
          htsmain_free();
          <B><FONT COLOR="#A020F0">return</FONT></B> -1;
        }
        tempo[strlen(tempo) - 1] = <B><FONT COLOR="#BC8F8F">'\0'</FONT></B>;
        strcpybuff(argv[na], tempo);
      }

      <B><FONT COLOR="#A020F0">if</FONT></B> (cmdl_opt(argv[na])) { <I><FONT COLOR="#B22222">// option
</FONT></I>        com = argv[na] + 1;

        <B><FONT COLOR="#A020F0">while</FONT></B>(*com) {
          <B><FONT COLOR="#A020F0">switch</FONT></B> (*com) {
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">' '</FONT></B>:
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#5F9EA0">9</FONT></B>:
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'-'</FONT></B>:
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'\0'</FONT></B>:
            <B><FONT COLOR="#A020F0">break</FONT></B>;
            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'h'</FONT></B>:
            help(argv[0], 0);
            htsmain_free();
            <B><FONT COLOR="#A020F0">return</FONT></B> 0;           <I><FONT COLOR="#B22222">// déja fait normalement
</FONT></I>            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'g'</FONT></B>:            <I><FONT COLOR="#B22222">// récupérer un (ou plusieurs) fichiers isolés
</FONT></I>            opt-&gt;wizard = 2;    <I><FONT COLOR="#B22222">// le wizard on peut plus s'en passer..
</FONT></I>            <I><FONT COLOR="#B22222">//opt-&gt;wizard=0;             // pas de wizard
</FONT></I>            opt-&gt;cache = 0;     <I><FONT COLOR="#B22222">// ni de cache
</FONT></I>            opt-&gt;makeindex = 0; <I><FONT COLOR="#B22222">// ni d'index
</FONT></I>            httrack_logmode = 1;        <I><FONT COLOR="#B22222">// erreurs à l'écran
</FONT></I>            opt-&gt;savename_type = 1003;  <I><FONT COLOR="#B22222">// mettre dans le répertoire courant
</FONT></I>            opt-&gt;depth = 0;     <I><FONT COLOR="#B22222">// ne pas explorer la page
</FONT></I>            opt-&gt;accept_cookie = 0;     <I><FONT COLOR="#B22222">// pas de cookies
</FONT></I>            opt-&gt;robots = 0;    <I><FONT COLOR="#B22222">// pas de robots
</FONT></I>            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'w'</FONT></B>:
            opt-&gt;wizard = 2;    <I><FONT COLOR="#B22222">// wizard 'soft' (ne pose pas de questions)
</FONT></I>            opt-&gt;travel = 0;
            opt-&gt;seeker = 1;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'W'</FONT></B>:
            opt-&gt;wizard = 1;    <I><FONT COLOR="#B22222">// Wizard-Help (pose des questions)
</FONT></I>            opt-&gt;travel = 0;
            opt-&gt;seeker = 1;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'r'</FONT></B>:            <I><FONT COLOR="#B22222">// n'est plus le recurse get bestial mais wizard itou!
</FONT></I>            <B><FONT COLOR="#A020F0">if</FONT></B> (isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1))) {
              sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;depth);
              <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
                com++;
            } <B><FONT COLOR="#A020F0">else</FONT></B>
              opt-&gt;depth = 3;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
<I><FONT COLOR="#B22222">/*
          case 'r': opt-&gt;wizard=0;
            if (isdigit((unsigned char)*(com+1))) {
              sscanf(com+1,&quot;%d&quot;,&amp;opt-&gt;depth);
              while(isdigit((unsigned char)*(com+1))) com++;
            } else opt-&gt;depth=3;
            break;
*/</FONT></I>
            <I><FONT COLOR="#B22222">//
</FONT></I>            <I><FONT COLOR="#B22222">// note: les tests opt-&gt;depth sont pour éviter de faire
</FONT></I>            <I><FONT COLOR="#B22222">// un miroir du web (:-O) accidentelement ;-)
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'a'</FONT></B>:            <I><FONT COLOR="#B22222">/*if (opt-&gt;depth==9999) opt-&gt;depth=3; */</FONT></I>
            opt-&gt;travel = 0 + (opt-&gt;travel &amp; 256);
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'d'</FONT></B>:            <I><FONT COLOR="#B22222">/*if (opt-&gt;depth==9999) opt-&gt;depth=3; */</FONT></I>
            opt-&gt;travel = 1 + (opt-&gt;travel &amp; 256);
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'l'</FONT></B>:            <I><FONT COLOR="#B22222">/*if (opt-&gt;depth==9999) opt-&gt;depth=3; */</FONT></I>
            opt-&gt;travel = 2 + (opt-&gt;travel &amp; 256);
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'e'</FONT></B>:            <I><FONT COLOR="#B22222">/*if (opt-&gt;depth==9999) opt-&gt;depth=3; */</FONT></I>
            opt-&gt;travel = 7 + (opt-&gt;travel &amp; 256);
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'t'</FONT></B>:
            opt-&gt;travel |= 256;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'n'</FONT></B>:
            opt-&gt;nearlink = 1;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'x'</FONT></B>:
            opt-&gt;external = 1;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'U'</FONT></B>:
            opt-&gt;seeker = 2;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'D'</FONT></B>:
            opt-&gt;seeker = 1;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'S'</FONT></B>:
            opt-&gt;seeker = 0;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'B'</FONT></B>:
            opt-&gt;seeker = 3;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'Y'</FONT></B>:
            opt-&gt;mirror_first_page = 1;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'q'</FONT></B>:
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'i'</FONT></B>:
            opt-&gt;quiet = 1;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'Q'</FONT></B>:
            httrack_logmode = 0;
            opt-&gt;debug = LOG_NOTICE;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'v'</FONT></B>:
            httrack_logmode = 1;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'f'</FONT></B>:
            httrack_logmode = 2;
            <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'2'</FONT></B>)
              httrack_logmode = 3;
            <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
              com++;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
            <I><FONT COLOR="#B22222">//
</FONT></I>            <I><FONT COLOR="#B22222">//case 'A': opt-&gt;urlmode=1; break;
</FONT></I>            <I><FONT COLOR="#B22222">//case 'R': opt-&gt;urlmode=2; break;
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'K'</FONT></B>:
            opt-&gt;urlmode = 0;
            <B><FONT COLOR="#A020F0">if</FONT></B> (isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1))) {
              sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;urlmode);
              <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;urlmode == 0) {  <I><FONT COLOR="#B22222">// in fact K0 ==&gt; K2
</FONT></I>                <I><FONT COLOR="#B22222">// and K ==&gt; K0
</FONT></I>                opt-&gt;urlmode = 2;
              }
              <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
                com++;
            }
            <I><FONT COLOR="#B22222">//if (*(com+1)=='0') { opt-&gt;urlmode=2; com++; } break;
</FONT></I>            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'c'</FONT></B>:
            <B><FONT COLOR="#A020F0">if</FONT></B> (isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1))) {
              sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;maxsoc);
              <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
                com++;
              opt-&gt;maxsoc = max(opt-&gt;maxsoc, 1);        <I><FONT COLOR="#B22222">// FORCER A 1
</FONT></I>            } <B><FONT COLOR="#A020F0">else</FONT></B>
              opt-&gt;maxsoc = 4;

            <B><FONT COLOR="#A020F0">break</FONT></B>;
            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'p'</FONT></B>:
            sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;getmode);
            <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
              com++;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
            <I><FONT COLOR="#B22222">//        
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'G'</FONT></B>:
            sscanf(com + 1, LLintP, &amp;opt-&gt;fragment);
            <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
              com++;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'M'</FONT></B>:
            sscanf(com + 1, LLintP, &amp;opt-&gt;maxsite);
            <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
              com++;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'m'</FONT></B>:
            <I><FONT COLOR="#B22222">// -m,10000 variant
</FONT></I>            <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) != <B><FONT COLOR="#BC8F8F">','</FONT></B>) {
              sscanf(com + 1, LLintP, &amp;opt-&gt;maxfile_nonhtml);
              <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
                com++;
            }
            <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">','</FONT></B> &amp;&amp; isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 2))) {
              com++;
              sscanf(com + 1, LLintP, &amp;opt-&gt;maxfile_html);
              <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
                com++;
            } <B><FONT COLOR="#A020F0">else</FONT></B>
              opt-&gt;maxfile_html = -1;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'T'</FONT></B>:
            sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;timeout);
            <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
              com++;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'J'</FONT></B>:
            sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;rateout);
            <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
              com++;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'R'</FONT></B>:
            sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;retry);
            <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
              com++;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'E'</FONT></B>:
            sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;maxtime);
            <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
              com++;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'H'</FONT></B>:
            sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;hostcontrol);
            <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
              com++;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'A'</FONT></B>:
            sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;maxrate);
            <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
              com++;
            <B><FONT COLOR="#A020F0">break</FONT></B>;

          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'j'</FONT></B>:
            opt-&gt;parsejava = HTSPARSE_DEFAULT;
            <B><FONT COLOR="#A020F0">if</FONT></B> (isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1))) {
              sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;parsejava);
              <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
                com++;
            }
            <B><FONT COLOR="#A020F0">break</FONT></B>;
            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'I'</FONT></B>:
            opt-&gt;makeindex = 1;
            <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
              opt-&gt;makeindex = 0;
              com++;
            }
            <B><FONT COLOR="#A020F0">break</FONT></B>;
            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'X'</FONT></B>:
            opt-&gt;delete_old = 1;
            <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
              opt-&gt;delete_old = 0;
              com++;
            }
            <B><FONT COLOR="#A020F0">break</FONT></B>;
            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'y'</FONT></B>:
            opt-&gt;background_on_suspend = 1;
            <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
              opt-&gt;background_on_suspend = 0;
              com++;
            }
            <B><FONT COLOR="#A020F0">break</FONT></B>;
            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'b'</FONT></B>:
            sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;accept_cookie);
            <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
              com++;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'N'</FONT></B>:
            <B><FONT COLOR="#A020F0">if</FONT></B> (strcmp(argv[na], <B><FONT COLOR="#BC8F8F">&quot;-N&quot;</FONT></B>) == 0) {  <I><FONT COLOR="#B22222">// Tout seul
</FONT></I>              <B><FONT COLOR="#A020F0">if</FONT></B> ((na + 1 &gt;= argc) || (argv[na + 1][0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>)) {       <I><FONT COLOR="#B22222">// erreur
</FONT></I>                HTS_PANIC_PRINTF
                  (<B><FONT COLOR="#BC8F8F">&quot;Option N needs a number, or needs to be followed by a blank space, and a string&quot;</FONT></B>);
                printf(<B><FONT COLOR="#BC8F8F">&quot;Example: -N4\n&quot;</FONT></B>);
                htsmain_free();
                <B><FONT COLOR="#A020F0">return</FONT></B> -1;
              } <B><FONT COLOR="#A020F0">else</FONT></B> {
                na++;
                <B><FONT COLOR="#A020F0">if</FONT></B> (strlen(argv[na]) &gt;= 127) {
                  HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;Userdef structure string too long&quot;</FONT></B>);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                }
                StringCopy(opt-&gt;savename_userdef, argv[na]);
                <B><FONT COLOR="#A020F0">if</FONT></B> (StringLength(opt-&gt;savename_userdef) &gt; 0)
                  opt-&gt;savename_type = -1;      <I><FONT COLOR="#B22222">// userdef!
</FONT></I>                <B><FONT COLOR="#A020F0">else</FONT></B>
                  opt-&gt;savename_type = 0;       <I><FONT COLOR="#B22222">// -N &quot;&quot; : par défaut
</FONT></I>              }
            } <B><FONT COLOR="#A020F0">else</FONT></B> {
              sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;savename_type);
              <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
                com++;
            }
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'L'</FONT></B>:
            {
              sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;savename_83);
              <B><FONT COLOR="#A020F0">switch</FONT></B> (opt-&gt;savename_83) {
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#5F9EA0">0</FONT></B>:          <I><FONT COLOR="#B22222">// 8-3 (ISO9660 L1)
</FONT></I>                opt-&gt;savename_83 = 1;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#5F9EA0">1</FONT></B>:
                opt-&gt;savename_83 = 0;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#5F9EA0">default</FONT></B>:         <I><FONT COLOR="#B22222">// 2 == ISO9660 (ISO9660 L2)
</FONT></I>                opt-&gt;savename_83 = 2;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              }
              <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
                com++;
            }
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'s'</FONT></B>:
            <B><FONT COLOR="#A020F0">if</FONT></B> (isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1))) {
              sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;robots);
              <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
                com++;
            } <B><FONT COLOR="#A020F0">else</FONT></B>
              opt-&gt;robots = 1;
#<B><FONT COLOR="#5F9EA0">if</FONT></B> <FONT COLOR="#B8860B">DEBUG_ROBOTS</FONT>
            printf(<B><FONT COLOR="#BC8F8F">&quot;robots.txt mode set to %d\n&quot;</FONT></B>, opt-&gt;robots);
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'o'</FONT></B>:
            sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;errpage);
            <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
              com++;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'u'</FONT></B>:
            sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;check_type);
            <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
              com++;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'C'</FONT></B>:
            <B><FONT COLOR="#A020F0">if</FONT></B> (isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1))) {
              sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;cache);
              <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
                com++;
            } <B><FONT COLOR="#A020F0">else</FONT></B>
              opt-&gt;cache = 1;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'k'</FONT></B>:
            opt-&gt;all_in_cache = 1;
            <B><FONT COLOR="#A020F0">break</FONT></B>;
            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'z'</FONT></B>:
            <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;debug &gt; LOG_INFO) {
              opt-&gt;debug = LOG_DEBUG;  <I><FONT COLOR="#B22222">/* -Zz */</FONT></I>
            } <B><FONT COLOR="#A020F0">else</FONT></B> {
              opt-&gt;debug = LOG_INFO;
            }
            <B><FONT COLOR="#A020F0">break</FONT></B>;              <I><FONT COLOR="#B22222">// petit debug
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'Z'</FONT></B>:
            <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;debug &gt;= LOG_DEBUG) {
              opt-&gt;debug = LOG_TRACE;  <I><FONT COLOR="#B22222">/* -Zz */</FONT></I>
            } <B><FONT COLOR="#A020F0">else</FONT></B> {
              opt-&gt;debug = LOG_DEBUG;
            }
            <B><FONT COLOR="#A020F0">break</FONT></B>;              <I><FONT COLOR="#B22222">// GROS debug
</FONT></I>            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'&amp;'</FONT></B>:
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'%'</FONT></B>:{           <I><FONT COLOR="#B22222">// deuxième jeu d'options
</FONT></I>              com++;
              <B><FONT COLOR="#A020F0">switch</FONT></B> (*com) {
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'M'</FONT></B>:
                opt-&gt;mimehtml = 1;
                <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
                  opt-&gt;mimehtml = 0;
                  com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'k'</FONT></B>:
                opt-&gt;nokeepalive = 0;
                <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
                  opt-&gt;nokeepalive = 1;
                  com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'x'</FONT></B>:
                opt-&gt;passprivacy = 1;
                <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
                  opt-&gt;passprivacy = 0;
                  com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;          <I><FONT COLOR="#B22222">// No passwords in html files
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'q'</FONT></B>:
                opt-&gt;includequery = 1;
                <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
                  opt-&gt;includequery = 0;
                  com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;          <I><FONT COLOR="#B22222">// No passwords in html files
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'I'</FONT></B>:
                opt-&gt;kindex = 1;
                <B><FONT COLOR="#A020F0">if</FONT></B> (isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1))) {
                  sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;kindex);
                  <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
                    com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;          <I><FONT COLOR="#B22222">// Keyword Index
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'c'</FONT></B>:
                sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%f&quot;</FONT></B>, &amp;opt-&gt;maxconn);
                <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)) || *(com + 1) == <B><FONT COLOR="#BC8F8F">'.'</FONT></B>)
                  com++;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'e'</FONT></B>:
                sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;extdepth);
                <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
                  com++;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'B'</FONT></B>:
                opt-&gt;tolerant = 1;
                <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
                  opt-&gt;tolerant = 0;
                  com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;          <I><FONT COLOR="#B22222">// HTTP/1.0 notamment
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'h'</FONT></B>:
                opt-&gt;http10 = 1;
                <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
                  opt-&gt;http10 = 0;
                  com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;          <I><FONT COLOR="#B22222">// HTTP/1.0
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'z'</FONT></B>:
                opt-&gt;nocompression = 1;
                <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
                  opt-&gt;nocompression = 0;
                  com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;          <I><FONT COLOR="#B22222">// pas de compression
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'f'</FONT></B>:
                opt-&gt;ftp_proxy = 1;
                <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
                  opt-&gt;ftp_proxy = 0;
                  com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;          <I><FONT COLOR="#B22222">// proxy http pour ftp
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'P'</FONT></B>:
                opt-&gt;parseall = 1;
                <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
                  opt-&gt;parseall = 0;
                  com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;          <I><FONT COLOR="#B22222">// tout parser
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'n'</FONT></B>:
                opt-&gt;norecatch = 1;
                <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
                  opt-&gt;norecatch = 0;
                  com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;          <I><FONT COLOR="#B22222">// ne pas reprendre fichiers effacés localement
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'s'</FONT></B>:
                opt-&gt;sizehack = 1;
                <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
                  opt-&gt;sizehack = 0;
                  com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;          <I><FONT COLOR="#B22222">// hack sur content-length
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'u'</FONT></B>:
                opt-&gt;urlhack = 1;
                <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
                  opt-&gt;urlhack = 0;
                  com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;          <I><FONT COLOR="#B22222">// url hack
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'v'</FONT></B>:
                opt-&gt;verbosedisplay = 2;
                <B><FONT COLOR="#A020F0">if</FONT></B> (isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1))) {
                  sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;verbosedisplay);
                  <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
                    com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'i'</FONT></B>:
                opt-&gt;dir_topindex = 1;
                <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
                  opt-&gt;dir_topindex = 0;
                  com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'N'</FONT></B>:
                opt-&gt;savename_delayed = 2;
                <B><FONT COLOR="#A020F0">if</FONT></B> (isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1))) {
                  sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;savename_delayed);
                  <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
                    com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'D'</FONT></B>:
                opt-&gt;delayed_cached = 1;
                <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
                  opt-&gt;delayed_cached = 0;
                  com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;          <I><FONT COLOR="#B22222">// url hack
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'T'</FONT></B>:
                opt-&gt;convert_utf8 = 1;
                <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
                  opt-&gt;convert_utf8 = 0;
                  com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;          <I><FONT COLOR="#B22222">// convert to utf-8
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'!'</FONT></B>:
                opt-&gt;bypass_limits = 1;
                <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
                  opt-&gt;bypass_limits = 0;
                  com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'w'</FONT></B>:        <I><FONT COLOR="#B22222">// disable specific plugin
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> ((na + 1 &gt;= argc) || (argv[na + 1][0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>)) {
                  HTS_PANIC_PRINTF
                    (<B><FONT COLOR="#BC8F8F">&quot;Option %w needs to be followed by a blank space, and a module name&quot;</FONT></B>);
                  printf(<B><FONT COLOR="#BC8F8F">&quot;Example: -%%w htsswf\n&quot;</FONT></B>);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  na++;
                  StringCat(opt-&gt;mod_blacklist, argv[na]);
                  StringCat(opt-&gt;mod_blacklist, <B><FONT COLOR="#BC8F8F">&quot;\n&quot;</FONT></B>);
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;

                <I><FONT COLOR="#B22222">// preserve: no footer, original links
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'p'</FONT></B>:
                StringClear(opt-&gt;footer);
                opt-&gt;urlmode = 4;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'L'</FONT></B>:        <I><FONT COLOR="#B22222">// URL list
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> ((na + 1 &gt;= argc) || (argv[na + 1][0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>)) {
                  HTS_PANIC_PRINTF
                    (<B><FONT COLOR="#BC8F8F">&quot;Option %L needs to be followed by a blank space, and a text filename&quot;</FONT></B>);
                  printf(<B><FONT COLOR="#BC8F8F">&quot;Example: -%%L \&quot;mylist.txt\&quot;\n&quot;</FONT></B>);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  na++;
                  <B><FONT COLOR="#A020F0">if</FONT></B> (strlen(argv[na]) &gt;= 254) {
                    HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;File list string too long&quot;</FONT></B>);
                    htsmain_free();
                    <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                  }
                  StringCopy(opt-&gt;filelist, argv[na]);
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'b'</FONT></B>:        <I><FONT COLOR="#B22222">// bind
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> ((na + 1 &gt;= argc) || (argv[na + 1][0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>)) {
                  HTS_PANIC_PRINTF
                    (<B><FONT COLOR="#BC8F8F">&quot;Option %b needs to be followed by a blank space, and a local hostname&quot;</FONT></B>);
                  printf(<B><FONT COLOR="#BC8F8F">&quot;Example: -%%b \&quot;ip4.localhost\&quot;\n&quot;</FONT></B>);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  na++;
                  <B><FONT COLOR="#A020F0">if</FONT></B> (strlen(argv[na]) &gt;= 254) {
                    HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;Hostname string too long&quot;</FONT></B>);
                    htsmain_free();
                    <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                  }
                  StringCopy(opt-&gt;proxy.bindhost, argv[na]);
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'S'</FONT></B>:        <I><FONT COLOR="#B22222">// Scan Rules list
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> ((na + 1 &gt;= argc) || (argv[na + 1][0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>)) {
                  HTS_PANIC_PRINTF
                    (<B><FONT COLOR="#BC8F8F">&quot;Option %S needs to be followed by a blank space, and a text filename&quot;</FONT></B>);
                  printf(<B><FONT COLOR="#BC8F8F">&quot;Example: -%%S \&quot;myfilterlist.txt\&quot;\n&quot;</FONT></B>);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  off_t fz;

                  na++;
                  fz = fsize(argv[na]);
                  <B><FONT COLOR="#A020F0">if</FONT></B> (fz &lt; 0) {
                    HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;File url list could not be opened&quot;</FONT></B>);
                    htsmain_free();
                    <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                  } <B><FONT COLOR="#A020F0">else</FONT></B> {
                    FILE *fp = fopen(argv[na], <B><FONT COLOR="#BC8F8F">&quot;rb&quot;</FONT></B>);

                    <B><FONT COLOR="#A020F0">if</FONT></B> (fp != NULL) {
                      <B><FONT COLOR="#228B22">int</FONT></B> cl = (<B><FONT COLOR="#228B22">int</FONT></B>) strlen(url);

                      ensureUrlCapacity(url, url_sz, cl + fz + 8192);
                      <B><FONT COLOR="#A020F0">if</FONT></B> (cl &gt; 0) {     <I><FONT COLOR="#B22222">/* don't stick! (3.43) */</FONT></I>
                        url[cl] = <B><FONT COLOR="#BC8F8F">' '</FONT></B>;
                        cl++;
                      }
                      <B><FONT COLOR="#A020F0">if</FONT></B> (fread(url + cl, 1, fz, fp) != fz) {
                        HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;File url list could not be read&quot;</FONT></B>);
                        htsmain_free();
                        <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                      }
                      fclose(fp);
                      *(url + cl + fz) = <B><FONT COLOR="#BC8F8F">'\0'</FONT></B>;
                    }
                  }
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'A'</FONT></B>:        <I><FONT COLOR="#B22222">// assume
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> ((na + 1 &gt;= argc) || (argv[na + 1][0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>)) {
                  HTS_PANIC_PRINTF
                    (<B><FONT COLOR="#BC8F8F">&quot;Option %A needs to be followed by a blank space, and a filesystemtype=mimetype/mimesubtype parameters&quot;</FONT></B>);
                  printf(<B><FONT COLOR="#BC8F8F">&quot;Example: -%%A php3=text/html,asp=text/html\n&quot;</FONT></B>);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  na++;
                  <I><FONT COLOR="#B22222">// --assume standard
</FONT></I>                  <B><FONT COLOR="#A020F0">if</FONT></B> (strcmp(argv[na], <B><FONT COLOR="#BC8F8F">&quot;standard&quot;</FONT></B>) == 0) {
                    StringCopy(opt-&gt;mimedefs, <B><FONT COLOR="#BC8F8F">&quot;\n&quot;</FONT></B>);
                    StringCat(opt-&gt;mimedefs, HTS_ASSUME_STANDARD);
                    StringCat(opt-&gt;mimedefs, <B><FONT COLOR="#BC8F8F">&quot;\n&quot;</FONT></B>);
                  } <B><FONT COLOR="#A020F0">else</FONT></B> {
                    <B><FONT COLOR="#228B22">char</FONT></B> *a;

                    <I><FONT COLOR="#B22222">//char* b = StringBuff(opt-&gt;mimedefs) + StringLength(opt-&gt;mimedefs);
</FONT></I>                    <B><FONT COLOR="#A020F0">for</FONT></B>(a = argv[na]; *a != <B><FONT COLOR="#BC8F8F">'\0'</FONT></B>; a++) {
                      <B><FONT COLOR="#A020F0">if</FONT></B> (*a == <B><FONT COLOR="#BC8F8F">';'</FONT></B>) {  <I><FONT COLOR="#B22222">/* next one */</FONT></I>
                        StringAddchar(opt-&gt;mimedefs, <B><FONT COLOR="#BC8F8F">'\n'</FONT></B>);
                        <I><FONT COLOR="#B22222">//*b++ = '\n';
</FONT></I>                      } <B><FONT COLOR="#A020F0">else</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> (*a == <B><FONT COLOR="#BC8F8F">','</FONT></B> || *a == <B><FONT COLOR="#BC8F8F">'\n'</FONT></B> || *a == <B><FONT COLOR="#BC8F8F">'\r'</FONT></B>
                                 || *a == <B><FONT COLOR="#BC8F8F">'\t'</FONT></B>) {
                        StringAddchar(opt-&gt;mimedefs, <B><FONT COLOR="#BC8F8F">' '</FONT></B>);
                        <I><FONT COLOR="#B22222">//*b++ = ' ';
</FONT></I>                      } <B><FONT COLOR="#A020F0">else</FONT></B> {
                        StringAddchar(opt-&gt;mimedefs, *a);
                        <I><FONT COLOR="#B22222">//*b++ = *a;
</FONT></I>                      }
                    }
                    StringAddchar(opt-&gt;mimedefs, <B><FONT COLOR="#BC8F8F">'\n'</FONT></B>);
                    <I><FONT COLOR="#B22222">//*b++ = '\n';    /* next def */
</FONT></I>                    <I><FONT COLOR="#B22222">//*b++ = '\0';
</FONT></I>                  }
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
                <I><FONT COLOR="#B22222">//
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'l'</FONT></B>: <I><FONT COLOR="#B22222">// Accept-language
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> ((na + 1 &gt;= argc) || (argv[na + 1][0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>)) {
                  HTS_PANIC_PRINTF
                    (<B><FONT COLOR="#BC8F8F">&quot;Option %l needs to be followed by a blank space, and an ISO language code&quot;</FONT></B>);
                  printf(<B><FONT COLOR="#BC8F8F">&quot;Example: -%%l \&quot;en\&quot;\n&quot;</FONT></B>);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  na++;
                  <B><FONT COLOR="#A020F0">if</FONT></B> (strlen(argv[na]) &gt;= 62) {
                    HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;Lang list string too long&quot;</FONT></B>);
                    htsmain_free();
                    <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                  }
                  StringCopy(opt-&gt;lang_iso, argv[na]);
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
                <I><FONT COLOR="#B22222">//
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'a'</FONT></B>:  <I><FONT COLOR="#B22222">// Accept
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> ((na + 1 &gt;= argc) || (argv[na + 1][0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>)) {
                  HTS_PANIC_PRINTF
                    (<B><FONT COLOR="#BC8F8F">&quot;Option %a needs to be followed by a blank space, and a list of formats&quot;</FONT></B>);
                  printf(<B><FONT COLOR="#BC8F8F">&quot;Example: -%%a \&quot;text/html,*/*;q=0.1\&quot;\n&quot;</FONT></B>);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  na++;
                  <B><FONT COLOR="#A020F0">if</FONT></B> (strlen(argv[na]) &gt;= 256) {
                    HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;Accept list string too long&quot;</FONT></B>);
                    htsmain_free();
                    <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                  }
                  StringCopy(opt-&gt;accept, argv[na]);
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
                <I><FONT COLOR="#B22222">//
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'X'</FONT></B>:  <I><FONT COLOR="#B22222">// HTTP header line
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> ((na + 1 &gt;= argc) || (argv[na + 1][0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>)) {
                  HTS_PANIC_PRINTF
                    (<B><FONT COLOR="#BC8F8F">&quot;Option %X needs to be followed by a blank space, and a raw HTTP header line&quot;</FONT></B>);
                  printf(<B><FONT COLOR="#BC8F8F">&quot;Example: -%%X \&quot;X-Magic: 42\&quot;\n&quot;</FONT></B>);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  na++;
                  <B><FONT COLOR="#A020F0">if</FONT></B> (argv[na][0] == <B><FONT COLOR="#BC8F8F">'\0'</FONT></B>) {
                    HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;Empty string given&quot;</FONT></B>);
                    htsmain_free();
                    <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                  } <B><FONT COLOR="#A020F0">else</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> (strlen(argv[na]) &gt;= 256) {
                    HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;Header line string too long&quot;</FONT></B>);
                    htsmain_free();
                    <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                  }
                  StringCat(opt-&gt;headers, argv[na]);
                  StringCat(opt-&gt;headers, <B><FONT COLOR="#BC8F8F">&quot;\r\n&quot;</FONT></B>);  <I><FONT COLOR="#B22222">/* separator */</FONT></I>
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
                <I><FONT COLOR="#B22222">//
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'F'</FONT></B>:        <I><FONT COLOR="#B22222">// footer id
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> ((na + 1 &gt;= argc) || (argv[na + 1][0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>)) {
                  HTS_PANIC_PRINTF
                    (<B><FONT COLOR="#BC8F8F">&quot;Option %F needs to be followed by a blank space, and a footer string&quot;</FONT></B>);
                  printf
                    (<B><FONT COLOR="#BC8F8F">&quot;Example: -%%F \&quot;&lt;!-- Mirrored from %%s by HTTrack Website Copier/&quot;</FONT></B>
                     HTTRACK_AFF_VERSION <B><FONT COLOR="#BC8F8F">&quot; &quot;</FONT></B> HTTRACK_AFF_AUTHORS
                     <B><FONT COLOR="#BC8F8F">&quot;, %%s --&gt;\&quot;\n&quot;</FONT></B>);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  na++;
                  <B><FONT COLOR="#A020F0">if</FONT></B> (strlen(argv[na]) &gt;= 254) {
                    HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;Footer string too long&quot;</FONT></B>);
                    htsmain_free();
                    <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                  }
                  StringCopy(opt-&gt;footer, argv[na]);
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'H'</FONT></B>:        <I><FONT COLOR="#B22222">// debug headers
</FONT></I>                _DEBUG_HEAD = 1;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'O'</FONT></B>:
                printf
                  (<B><FONT COLOR="#BC8F8F">&quot;Warning option -%%O is no longer supported\n&quot;</FONT></B>);
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'U'</FONT></B>:        <I><FONT COLOR="#B22222">// setuid ; removed because insane
</FONT></I>                HTS_PANIC_PRINTF
                  (<B><FONT COLOR="#BC8F8F">&quot;Option %U is no longer supported&quot;</FONT></B>);
                htsmain_free();
                <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                <B><FONT COLOR="#A020F0">break</FONT></B>;

              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'W'</FONT></B>:        <I><FONT COLOR="#B22222">// Wrapper callback
</FONT></I>                <I><FONT COLOR="#B22222">// --wrapper check-link=obj.so:check_link
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> ((na + 1 &gt;= argc) || (argv[na + 1][0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>)) {
                  HTS_PANIC_PRINTF
                    (<B><FONT COLOR="#BC8F8F">&quot;Option %W needs to be followed by a blank space, and a &lt;callback-name&gt;=&lt;myfile.so&gt;:&lt;function-name&gt; field&quot;</FONT></B>);
                  printf(<B><FONT COLOR="#BC8F8F">&quot;Example: -%%W check-link=checklink.so:check\n&quot;</FONT></B>);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  <B><FONT COLOR="#228B22">char</FONT></B> *pos;

                  na++;
                  <B><FONT COLOR="#A020F0">for</FONT></B>(pos = argv[na];
                      *pos != <B><FONT COLOR="#BC8F8F">'\0'</FONT></B> &amp;&amp; *pos != <B><FONT COLOR="#BC8F8F">'='</FONT></B> &amp;&amp; *pos != <B><FONT COLOR="#BC8F8F">','</FONT></B> &amp;&amp; *pos != <B><FONT COLOR="#BC8F8F">':'</FONT></B>;
                      pos++) ;
                  <I><FONT COLOR="#B22222">/* httrack --wrapper callback[,foo] */</FONT></I>
                  <B><FONT COLOR="#A020F0">if</FONT></B> (*pos == 0 || *pos == <B><FONT COLOR="#BC8F8F">','</FONT></B> || *pos == <B><FONT COLOR="#BC8F8F">':'</FONT></B>) {
                    <B><FONT COLOR="#228B22">int</FONT></B> ret;
                    <B><FONT COLOR="#228B22">char</FONT></B> *moduleName;

                    <B><FONT COLOR="#A020F0">if</FONT></B> (*pos == <B><FONT COLOR="#BC8F8F">','</FONT></B> || *pos == <B><FONT COLOR="#BC8F8F">':'</FONT></B>) {
                      *pos = <B><FONT COLOR="#BC8F8F">'\0'</FONT></B>;
                      moduleName = strdupt(argv[na]);
                      *pos = <B><FONT COLOR="#BC8F8F">','</FONT></B>;       <I><FONT COLOR="#B22222">/* foce seperator to ',' */</FONT></I>
                    } <B><FONT COLOR="#A020F0">else</FONT></B> {
                      moduleName = strdupt(argv[na]);
                    }
                    ret = plug_wrapper(opt, moduleName, argv[na]);
                    freet(moduleName);
                    <B><FONT COLOR="#A020F0">if</FONT></B> (ret == 0) {
                      <B><FONT COLOR="#228B22">char</FONT></B> BIGSTK tmp[1024 * 2];

                      sprintf(tmp,
                              <B><FONT COLOR="#BC8F8F">&quot;option %%W : unable to plug the module %s (returncode != 1)&quot;</FONT></B>,
                              argv[na]);
                      HTS_PANIC_PRINTF(tmp);
                      htsmain_free();
                      <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                    } <B><FONT COLOR="#A020F0">else</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> (ret == -1) {
                      <B><FONT COLOR="#228B22">char</FONT></B> BIGSTK tmp[1024 * 2];
                      <B><FONT COLOR="#228B22">int</FONT></B> last_errno = errno;

                      sprintf(tmp,
                              <B><FONT COLOR="#BC8F8F">&quot;option %%W : unable to load the module %s: %s (check the library path ?)&quot;</FONT></B>,
                              argv[na], strerror(last_errno));
                      HTS_PANIC_PRINTF(tmp);
                      htsmain_free();
                      <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                    }
                  }
                  <I><FONT COLOR="#B22222">/* Old style */</FONT></I>
                  <I><FONT COLOR="#B22222">/* httrack --wrapper save-name=callback:process,string */</FONT></I>
                  <B><FONT COLOR="#A020F0">else</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> (*pos == <B><FONT COLOR="#BC8F8F">'='</FONT></B>) {
                    fprintf(stderr,
                            <B><FONT COLOR="#BC8F8F">&quot;Syntax error in option %%W : the old (&lt;3.41) API is no more supported!\n&quot;</FONT></B>);
                    HTS_PANIC_PRINTF
                      (<B><FONT COLOR="#BC8F8F">&quot;Syntax error in option %W : the old (&lt;3.41) API is no more supported!&quot;</FONT></B>);
                    printf(<B><FONT COLOR="#BC8F8F">&quot;Example: -%%W check-link=checklink.so:check\n&quot;</FONT></B>);
                    htsmain_free();
                    <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                  } <B><FONT COLOR="#A020F0">else</FONT></B> {
                    HTS_PANIC_PRINTF
                      (<B><FONT COLOR="#BC8F8F">&quot;Syntax error in option %W : this function needs to be followed by a blank space, and a module name&quot;</FONT></B>);
                    printf(<B><FONT COLOR="#BC8F8F">&quot;Example: -%%W check-link=checklink.so:check\n&quot;</FONT></B>);
                    htsmain_free();
                    <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                  }
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;

              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'R'</FONT></B>:        <I><FONT COLOR="#B22222">// Referer
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> ((na + 1 &gt;= argc) || (argv[na + 1][0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>)) {
                  HTS_PANIC_PRINTF
                    (<B><FONT COLOR="#BC8F8F">&quot;Option %R needs to be followed by a blank space, and a referer URL&quot;</FONT></B>);
                  printf(<B><FONT COLOR="#BC8F8F">&quot;Example: -%%R \&quot;http://www.example.com/\&quot;\n&quot;</FONT></B>);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  na++;
                  <B><FONT COLOR="#A020F0">if</FONT></B> (strlen(argv[na]) &gt;= 254) {
                    HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;Referer URL too long&quot;</FONT></B>);
                    htsmain_free();
                    <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                  }
                  StringCopy(opt-&gt;referer, argv[na]);
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'E'</FONT></B>:        <I><FONT COLOR="#B22222">// From Email address
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> ((na + 1 &gt;= argc) || (argv[na + 1][0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>)) {
                  HTS_PANIC_PRINTF
                    (<B><FONT COLOR="#BC8F8F">&quot;Option %E needs to be followed by a blank space, and an email&quot;</FONT></B>);
                  printf(<B><FONT COLOR="#BC8F8F">&quot;Example: -%%E \&quot;postmaster@example.com\&quot;\n&quot;</FONT></B>);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  na++;
                  <B><FONT COLOR="#A020F0">if</FONT></B> (strlen(argv[na]) &gt;= 254) {
                    HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;From email too long&quot;</FONT></B>);
                    htsmain_free();
                    <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                  }
                  StringCopy(opt-&gt;from, argv[na]);
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;

              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'t'</FONT></B>:        <I><FONT COLOR="#B22222">/* do not change type (ending) of filenames according to the MIME type */</FONT></I>
                opt-&gt;no_type_change = 1;
                <B><FONT COLOR="#A020F0">if</FONT></B> (*(com+1)==<B><FONT COLOR="#BC8F8F">'0'</FONT></B>) { opt-&gt;no_type_change = 0; com++; }
                <B><FONT COLOR="#A020F0">break</FONT></B>;

              <B><FONT COLOR="#5F9EA0">default</FONT></B>:{
                  <B><FONT COLOR="#228B22">char</FONT></B> s[HTS_CDLMAXSIZE + 256];

                  sprintf(s, <B><FONT COLOR="#BC8F8F">&quot;invalid option %%%c\n&quot;</FONT></B>, *com);
                  HTS_PANIC_PRINTF(s);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;

              }
            }
            <B><FONT COLOR="#A020F0">break</FONT></B>;
            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'@'</FONT></B>:{           <I><FONT COLOR="#B22222">// troisième jeu d'options
</FONT></I>              com++;
              <B><FONT COLOR="#A020F0">switch</FONT></B> (*com) {
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'i'</FONT></B>:
#<B><FONT COLOR="#5F9EA0">if</FONT></B> <FONT COLOR="#B8860B">HTS_INET6</FONT>==0
                printf
                  (<B><FONT COLOR="#BC8F8F">&quot;Warning, option @i has no effect (v6 routines not compiled)\n&quot;</FONT></B>);
#<B><FONT COLOR="#5F9EA0">else</FONT></B>
                {
                  <B><FONT COLOR="#228B22">int</FONT></B> res = 0;

                  <B><FONT COLOR="#A020F0">if</FONT></B> (isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1))) {
                    sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;res);
                    <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
                      com++;
                  }
                  <B><FONT COLOR="#A020F0">switch</FONT></B> (res) {
                  <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#5F9EA0">1</FONT></B>:
                  <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#5F9EA0">4</FONT></B>:
                    IPV6_resolver = 1;
                    <B><FONT COLOR="#A020F0">break</FONT></B>;
                  <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#5F9EA0">2</FONT></B>:
                  <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#5F9EA0">6</FONT></B>:
                    IPV6_resolver = 2;
                    <B><FONT COLOR="#A020F0">break</FONT></B>;
                  <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#5F9EA0">0</FONT></B>:
                    IPV6_resolver = 0;
                    <B><FONT COLOR="#A020F0">break</FONT></B>;
                  <B><FONT COLOR="#5F9EA0">default</FONT></B>:
                    printf(<B><FONT COLOR="#BC8F8F">&quot;Unknown flag @i%d\n&quot;</FONT></B>, res);
                    htsmain_free();
                    <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                    <B><FONT COLOR="#A020F0">break</FONT></B>;
                  }
                }
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
                <B><FONT COLOR="#A020F0">break</FONT></B>;

              <B><FONT COLOR="#5F9EA0">default</FONT></B>:{
                  <B><FONT COLOR="#228B22">char</FONT></B> s[HTS_CDLMAXSIZE + 256];

                  sprintf(s, <B><FONT COLOR="#BC8F8F">&quot;invalid option %%%c\n&quot;</FONT></B>, *com);
                  HTS_PANIC_PRINTF(s);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;

                <I><FONT COLOR="#B22222">//case 's': opt-&gt;sslengine=1; if (isdigit((unsigned char)*(com+1))) { sscanf(com+1,&quot;%d&quot;,&amp;opt-&gt;sslengine); while(isdigit((unsigned char)*(com+1))) com++; } break;
</FONT></I>              }
            }
            <B><FONT COLOR="#A020F0">break</FONT></B>;

            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'#'</FONT></B>:{           <I><FONT COLOR="#B22222">// non documenté
</FONT></I>              com++;
              <B><FONT COLOR="#A020F0">switch</FONT></B> (*com) {
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'C'</FONT></B>:        <I><FONT COLOR="#B22222">// list cache files : httrack -#C '*spid*.gif' will attempt to find the matching file
</FONT></I>                {
                  <B><FONT COLOR="#228B22">int</FONT></B> hasFilter = 0;
                  <B><FONT COLOR="#228B22">int</FONT></B> found = 0;
                  <B><FONT COLOR="#228B22">char</FONT></B> *filter = NULL;
                  cache_back cache;
                  coucal cache_hashtable = coucal_new(0);
                  <B><FONT COLOR="#228B22">int</FONT></B> sendb = 0;

                  <B><FONT COLOR="#A020F0">if</FONT></B> (isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1))) {
                    sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;sendb);
                    <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
                      com++;
                  } <B><FONT COLOR="#A020F0">else</FONT></B>
                    sendb = 0;
                  <B><FONT COLOR="#A020F0">if</FONT></B> (!((na + 1 &gt;= argc) || (argv[na + 1][0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>))) {
                    na++;
                    hasFilter = 1;
                    filter = argv[na];
                  }

                  memset(&amp;cache, 0, <B><FONT COLOR="#A020F0">sizeof</FONT></B>(cache_back));
                  cache.type = 1;       <I><FONT COLOR="#B22222">// cache?
</FONT></I>                  cache.log = stdout;   <I><FONT COLOR="#B22222">// log?
</FONT></I>                  cache.errlog = stderr;        <I><FONT COLOR="#B22222">// err log?
</FONT></I>                  cache.ptr_ant = cache.ptr_last = 0;   <I><FONT COLOR="#B22222">// pointeur pour anticiper
</FONT></I>                  cache.hashtable = (<B><FONT COLOR="#228B22">void</FONT></B> *) cache_hashtable;   <I><FONT COLOR="#B22222">/* copy backcache hash */</FONT></I>
                  cache.ro = 1; <I><FONT COLOR="#B22222">/* read only */</FONT></I>
                  <B><FONT COLOR="#A020F0">if</FONT></B> (cache.hashtable) {
                    lien_adrfilsave afs;
                    <B><FONT COLOR="#228B22">char</FONT></B> BIGSTK url[HTS_URLMAXSIZE * 2];
                    <B><FONT COLOR="#228B22">char</FONT></B> linepos[256];
                    <B><FONT COLOR="#228B22">int</FONT></B> pos;
                    <B><FONT COLOR="#228B22">char</FONT></B> *cacheNdx =
                      readfile(fconcat
                               (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                                <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.ndx&quot;</FONT></B>));
                    cache_init(&amp;cache, opt);    <I><FONT COLOR="#B22222">/* load cache */</FONT></I>
                    <B><FONT COLOR="#A020F0">if</FONT></B> (cacheNdx != NULL) {
                      <B><FONT COLOR="#228B22">char</FONT></B> firstline[256];
                      <B><FONT COLOR="#228B22">char</FONT></B> *a = cacheNdx;

                      a += cache_brstr(a, firstline);
                      a += cache_brstr(a, firstline);
                      <B><FONT COLOR="#A020F0">while</FONT></B>(a != NULL) {
                        a = strchr(a + 1, <B><FONT COLOR="#BC8F8F">'\n'</FONT></B>);        <I><FONT COLOR="#B22222">/* start of line */</FONT></I>
                        <B><FONT COLOR="#A020F0">if</FONT></B> (a) {
                          htsblk r;

                          <I><FONT COLOR="#B22222">/* */</FONT></I>
                          a++;
                          <I><FONT COLOR="#B22222">/* read &quot;host/file&quot; */</FONT></I>
                          a += binput(a, afs.af.adr, HTS_URLMAXSIZE);
                          a += binput(a, afs.af.fil, HTS_URLMAXSIZE);
                          url[0] = <B><FONT COLOR="#BC8F8F">'\0'</FONT></B>;
                          <B><FONT COLOR="#A020F0">if</FONT></B> (!link_has_authority(afs.af.adr))
                            strcatbuff(url, <B><FONT COLOR="#BC8F8F">&quot;http://&quot;</FONT></B>);
                          strcatbuff(url, afs.af.adr);
                          strcatbuff(url, afs.af.fil);
                          <I><FONT COLOR="#B22222">/* read position */</FONT></I>
                          a += binput(a, linepos, 200);
                          sscanf(linepos, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;pos);
                          <B><FONT COLOR="#A020F0">if</FONT></B> (!hasFilter
                              || (strjoker(url, filter, NULL, NULL) != NULL)
                            ) {
                            r = cache_read_ro(opt, &amp;cache, afs.af.adr, afs.af.fil, <B><FONT COLOR="#BC8F8F">&quot;&quot;</FONT></B>, NULL); <I><FONT COLOR="#B22222">// lire entrée cache + data
</FONT></I>                            <B><FONT COLOR="#A020F0">if</FONT></B> (r.statuscode != -1) {   <I><FONT COLOR="#B22222">// No errors
</FONT></I>                              found++;
                              <B><FONT COLOR="#A020F0">if</FONT></B> (!hasFilter) {
                                fprintf(stdout, <B><FONT COLOR="#BC8F8F">&quot;%s%s%s\r\n&quot;</FONT></B>,
                                        (link_has_authority(afs.af.adr)) ? <B><FONT COLOR="#BC8F8F">&quot;&quot;</FONT></B> :
                                        <B><FONT COLOR="#BC8F8F">&quot;http://&quot;</FONT></B>, afs.af.adr, afs.af.fil);
                              } <B><FONT COLOR="#A020F0">else</FONT></B> {
                                <B><FONT COLOR="#228B22">char</FONT></B> msg[256], cdate[256];

                                infostatuscode(msg, r.statuscode);
                                time_gmt_rfc822(cdate);

                                fprintf(stdout, <B><FONT COLOR="#BC8F8F">&quot;HTTP/1.1 %d %s\r\n&quot;</FONT></B>,
                                        r.statuscode, r.msg[0] ? r.msg : msg);
                                fprintf(stdout, <B><FONT COLOR="#BC8F8F">&quot;X-Host: %s\r\n&quot;</FONT></B>, afs.af.adr);
                                fprintf(stdout, <B><FONT COLOR="#BC8F8F">&quot;X-File: %s\r\n&quot;</FONT></B>, afs.af.fil);
                                fprintf(stdout, <B><FONT COLOR="#BC8F8F">&quot;X-URL: %s%s%s\r\n&quot;</FONT></B>,
                                        (link_has_authority(afs.af.adr)) ? <B><FONT COLOR="#BC8F8F">&quot;&quot;</FONT></B> :
                                        <B><FONT COLOR="#BC8F8F">&quot;http://&quot;</FONT></B>, afs.af.adr, afs.af.fil);
                                <B><FONT COLOR="#A020F0">if</FONT></B> (url_savename
                                    (&amp;afs, <I><FONT COLOR="#B22222">/*former */</FONT></I> NULL,
                                     <I><FONT COLOR="#B22222">/*referer_adr */</FONT></I>
                                     NULL, <I><FONT COLOR="#B22222">/*referer_fil */</FONT></I> NULL,
                                     <I><FONT COLOR="#B22222">/*opt */</FONT></I> opt, <I><FONT COLOR="#B22222">/*sback */</FONT></I> NULL,
                                     <I><FONT COLOR="#B22222">/*cache */</FONT></I> &amp;cache, <I><FONT COLOR="#B22222">/*hash */</FONT></I> NULL, <I><FONT COLOR="#B22222">/*ptr */</FONT></I>
                                     0, <I><FONT COLOR="#B22222">/*numero_passe */</FONT></I> 0, <I><FONT COLOR="#B22222">/*mime_type */</FONT></I>
                                     NULL) != -1) {
                                  <B><FONT COLOR="#A020F0">if</FONT></B> (fexist(afs.save)) {
                                    fprintf(stdout, <B><FONT COLOR="#BC8F8F">&quot;Content-location: %s\r\n&quot;</FONT></B>,
                                            afs.save);
                                  }
                                }
                                fprintf(stdout, <B><FONT COLOR="#BC8F8F">&quot;Date: %s\r\n&quot;</FONT></B>, cdate);
                                fprintf(stdout,
                                        <B><FONT COLOR="#BC8F8F">&quot;Server: HTTrack Website Copier/&quot;</FONT></B>
                                        HTTRACK_VERSION <B><FONT COLOR="#BC8F8F">&quot;\r\n&quot;</FONT></B>);
                                <B><FONT COLOR="#A020F0">if</FONT></B> (r.lastmodified[0]) {
                                  fprintf(stdout, <B><FONT COLOR="#BC8F8F">&quot;Last-Modified: %s\r\n&quot;</FONT></B>,
                                          r.lastmodified);
                                }
                                <B><FONT COLOR="#A020F0">if</FONT></B> (r.etag[0]) {
                                  fprintf(stdout, <B><FONT COLOR="#BC8F8F">&quot;Etag: %s\r\n&quot;</FONT></B>, r.etag);
                                }
                                <B><FONT COLOR="#A020F0">if</FONT></B> (r.totalsize &gt;= 0) {
                                  fprintf(stdout,
                                          <B><FONT COLOR="#BC8F8F">&quot;Content-Length: &quot;</FONT></B> LLintP <B><FONT COLOR="#BC8F8F">&quot;\r\n&quot;</FONT></B>,
                                          r.totalsize);
                                }
                                fprintf(stdout,
                                        <B><FONT COLOR="#BC8F8F">&quot;X-Content-Length: &quot;</FONT></B> LLintP <B><FONT COLOR="#BC8F8F">&quot;\r\n&quot;</FONT></B>,
                                        (r.size &gt;= 0) ? r.size : (-r.size));
                                <B><FONT COLOR="#A020F0">if</FONT></B> (r.contenttype &gt;= 0) {
                                  fprintf(stdout, <B><FONT COLOR="#BC8F8F">&quot;Content-Type: %s\r\n&quot;</FONT></B>,
                                          r.contenttype);
                                }
                                <B><FONT COLOR="#A020F0">if</FONT></B> (r.cdispo[0]) {
                                  fprintf(stdout, <B><FONT COLOR="#BC8F8F">&quot;Content-Disposition: %s\r\n&quot;</FONT></B>,
                                          r.cdispo);
                                }
                                <B><FONT COLOR="#A020F0">if</FONT></B> (r.contentencoding[0]) {
                                  fprintf(stdout, <B><FONT COLOR="#BC8F8F">&quot;Content-Encoding: %s\r\n&quot;</FONT></B>,
                                          r.contentencoding);
                                }
                                <B><FONT COLOR="#A020F0">if</FONT></B> (r.is_chunk) {
                                  fprintf(stdout,
                                          <B><FONT COLOR="#BC8F8F">&quot;Transfer-Encoding: chunked\r\n&quot;</FONT></B>);
                                }
#<B><FONT COLOR="#5F9EA0">if</FONT></B> <FONT COLOR="#B8860B">HTS_USEOPENSSL</FONT>
                                <B><FONT COLOR="#A020F0">if</FONT></B> (r.ssl) {
                                  fprintf(stdout, <B><FONT COLOR="#BC8F8F">&quot;X-SSL: yes\r\n&quot;</FONT></B>);
                                }
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
                                <B><FONT COLOR="#A020F0">if</FONT></B> (r.is_write) {
                                  fprintf(stdout, <B><FONT COLOR="#BC8F8F">&quot;X-Direct-To-Disk: yes\r\n&quot;</FONT></B>);
                                }
                                <B><FONT COLOR="#A020F0">if</FONT></B> (r.compressed) {
                                  fprintf(stdout, <B><FONT COLOR="#BC8F8F">&quot;X-Compressed: yes\r\n&quot;</FONT></B>);
                                }
                                <B><FONT COLOR="#A020F0">if</FONT></B> (r.notmodified) {
                                  fprintf(stdout, <B><FONT COLOR="#BC8F8F">&quot;X-Not-Modified: yes\r\n&quot;</FONT></B>);
                                }
                                <B><FONT COLOR="#A020F0">if</FONT></B> (r.is_chunk) {
                                  fprintf(stdout, <B><FONT COLOR="#BC8F8F">&quot;X-Chunked: yes\r\n&quot;</FONT></B>);
                                }
                                fprintf(stdout, <B><FONT COLOR="#BC8F8F">&quot;\r\n&quot;</FONT></B>);
                                <I><FONT COLOR="#B22222">/* Send the body */</FONT></I>
                                <B><FONT COLOR="#A020F0">if</FONT></B> (sendb &amp;&amp; r.adr) {
                                  fprintf(stdout, <B><FONT COLOR="#BC8F8F">&quot;%s\r\n&quot;</FONT></B>, r.adr);
                                }
                              }
                            }
                          }
                        }
                      }
                      freet(cacheNdx);
                    }
                  }
                  <B><FONT COLOR="#A020F0">if</FONT></B> (!found) {
                    fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;No cache entry found%s%s%s\r\n&quot;</FONT></B>,
                            (hasFilter) ? <B><FONT COLOR="#BC8F8F">&quot; for '&quot;</FONT></B> : <B><FONT COLOR="#BC8F8F">&quot;&quot;</FONT></B>,
                            (hasFilter) ? filter : <B><FONT COLOR="#BC8F8F">&quot;&quot;</FONT></B>, (hasFilter) ? <B><FONT COLOR="#BC8F8F">&quot;'&quot;</FONT></B> : <B><FONT COLOR="#BC8F8F">&quot;&quot;</FONT></B>);
                  }
                  <B><FONT COLOR="#A020F0">return</FONT></B> 0;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'E'</FONT></B>:        <I><FONT COLOR="#B22222">// extract cache
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> (!hts_extract_meta(StringBuff(opt-&gt;path_log))) {
                  fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;* error extracting meta-data\n&quot;</FONT></B>);
                  <B><FONT COLOR="#A020F0">return</FONT></B> 1;
                }
                fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;* successfully extracted meta-data\n&quot;</FONT></B>);
                <B><FONT COLOR="#A020F0">return</FONT></B> 0;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'X'</FONT></B>:
                fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;warning: option has no effect\n&quot;</FONT></B>);
                <B><FONT COLOR="#A020F0">if</FONT></B> (*(com + 1) == <B><FONT COLOR="#BC8F8F">'0'</FONT></B>) {
                  com++;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'R'</FONT></B>:
                {
                  <B><FONT COLOR="#228B22">char</FONT></B> *name;
                  uLong repaired = 0;
                  uLong repairedBytes = 0;

                  <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
                      (fconcat
                       (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                        <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.zip&quot;</FONT></B>))) {
                    name =
                      fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                              <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.zip&quot;</FONT></B>);
                  } <B><FONT COLOR="#A020F0">else</FONT></B>
                    <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
                        (fconcat
                         (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                          <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.zip&quot;</FONT></B>))) {
                    name =
                      fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                              <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.zip&quot;</FONT></B>);
                  } <B><FONT COLOR="#A020F0">else</FONT></B> {
                    fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;* error: no cache found in %s\n&quot;</FONT></B>,
                            fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
                                    StringBuff(opt-&gt;path_log),
                                    <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.zip&quot;</FONT></B>));
                    <B><FONT COLOR="#A020F0">return</FONT></B> 1;
                  }
                  fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;Cache: trying to repair %s\n&quot;</FONT></B>, name);
                  <B><FONT COLOR="#A020F0">if</FONT></B> (unzRepair
                      (name,
                       fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                               <B><FONT COLOR="#BC8F8F">&quot;hts-cache/repair.zip&quot;</FONT></B>),
                       fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                               <B><FONT COLOR="#BC8F8F">&quot;hts-cache/repair.tmp&quot;</FONT></B>), &amp;repaired,
                       &amp;repairedBytes) == Z_OK) {
                    unlink(name);
                    rename(fconcat
                           (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                            <B><FONT COLOR="#BC8F8F">&quot;hts-cache/repair.zip&quot;</FONT></B>), name);
                    fprintf(stderr,
                            <B><FONT COLOR="#BC8F8F">&quot;Cache: %d bytes successfully recovered in %d entries\n&quot;</FONT></B>,
                            (<B><FONT COLOR="#228B22">int</FONT></B>) repairedBytes, (<B><FONT COLOR="#228B22">int</FONT></B>) repaired);
                  } <B><FONT COLOR="#A020F0">else</FONT></B> {
                    fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;Cache: could not repair the cache\n&quot;</FONT></B>);
                  }
                }
                <B><FONT COLOR="#A020F0">return</FONT></B> 0;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'~'</FONT></B>:        <I><FONT COLOR="#B22222">/* internal lib test */</FONT></I>
                HTS_PANIC_PRINTF
                  (<B><FONT COLOR="#BC8F8F">&quot;Option #~ is disabled for security reasons&quot;</FONT></B>);
                <I><FONT COLOR="#B22222">//Disabled because choke on GCC 4.3 (toni from links2linux.de)
</FONT></I>                <I><FONT COLOR="#B22222">//{
</FONT></I>                <I><FONT COLOR="#B22222">//  char thisIsATestYouShouldSeeAnError[12];
</FONT></I>                <I><FONT COLOR="#B22222">//  const char *const bufferOverflowTest = &quot;0123456789012345678901234567890123456789&quot;;
</FONT></I>                <I><FONT COLOR="#B22222">//  strcpybuff(thisIsATestYouShouldSeeAnError, bufferOverflowTest);
</FONT></I>                <I><FONT COLOR="#B22222">//  return 0;
</FONT></I>                <I><FONT COLOR="#B22222">//}
</FONT></I>                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'f'</FONT></B>:
                opt-&gt;flush = 1;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'h'</FONT></B>:
                printf(<B><FONT COLOR="#BC8F8F">&quot;HTTrack version &quot;</FONT></B> HTTRACK_VERSION <B><FONT COLOR="#BC8F8F">&quot;%s\n&quot;</FONT></B>,
                       hts_get_version_info(opt));
                <B><FONT COLOR="#A020F0">return</FONT></B> 0;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'p'</FONT></B>:        <I><FONT COLOR="#B22222">/* opt-&gt;aff_progress=1; deprecated */</FONT></I>
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'S'</FONT></B>:
                opt-&gt;shell = 1;
                <B><FONT COLOR="#A020F0">break</FONT></B>;          <I><FONT COLOR="#B22222">// stdin sur un shell
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'K'</FONT></B>:
                opt-&gt;keyboard = 1;
                <B><FONT COLOR="#A020F0">break</FONT></B>;          <I><FONT COLOR="#B22222">// vérifier stdin
</FONT></I>                <I><FONT COLOR="#B22222">//
</FONT></I>              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'L'</FONT></B>:
                sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;maxlink);
                <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
                  com++;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'F'</FONT></B>:
                sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;maxfilter);
                <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
                  com++;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'Z'</FONT></B>:
                opt-&gt;makestat = 1;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'T'</FONT></B>:
                opt-&gt;maketrack = 1;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'u'</FONT></B>:
                sscanf(com + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;waittime);
                <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit((<B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B>) *(com + 1)))
                  com++;
                <B><FONT COLOR="#A020F0">break</FONT></B>;

                <I><FONT COLOR="#B22222">/*case 'R':    // ohh ftp, catch-&gt;ftpget
                   HTS_PANIC_PRINTF(&quot;Unexpected internal error with -#R command&quot;);
                   htsmain_free();
                   return -1;        
                   break;
                 */</FONT></I>
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'P'</FONT></B>:{       <I><FONT COLOR="#B22222">// catchurl
</FONT></I>                  help_catchurl(StringBuff(opt-&gt;path_log));
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> 0;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;

              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'0'</FONT></B>:        <I><FONT COLOR="#B22222">/* test #0 : filters */</FONT></I>
                <B><FONT COLOR="#A020F0">if</FONT></B> (na + 2 &gt;= argc) {
                  HTS_PANIC_PRINTF
                    (<B><FONT COLOR="#BC8F8F">&quot;Option #0 needs to be followed by a filter string and a string&quot;</FONT></B>);
                  printf(<B><FONT COLOR="#BC8F8F">&quot;Example: '-#0' '*.gif' 'foo.gif'\n&quot;</FONT></B>);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  <B><FONT COLOR="#A020F0">if</FONT></B> (strjoker(argv[na + 2], argv[na + 1], NULL, NULL))
                    printf(<B><FONT COLOR="#BC8F8F">&quot;%s does match %s\n&quot;</FONT></B>, argv[na + 2], argv[na + 1]);
                  <B><FONT COLOR="#A020F0">else</FONT></B>
                    printf(<B><FONT COLOR="#BC8F8F">&quot;%s does NOT match %s\n&quot;</FONT></B>, argv[na + 2],
                           argv[na + 1]);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> 0;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'1'</FONT></B>:        <I><FONT COLOR="#B22222">/* test #1 : fil_simplifie */</FONT></I>
                <B><FONT COLOR="#A020F0">if</FONT></B> (na + 1 &gt;= argc) {
                  HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;Option #1 needs to be followed by an URL&quot;</FONT></B>);
                  printf(<B><FONT COLOR="#BC8F8F">&quot;Example: '-#1' ./foo/bar/../foobar\n&quot;</FONT></B>);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  fil_simplifie(argv[na + 1]);
                  printf(<B><FONT COLOR="#BC8F8F">&quot;simplified=%s\n&quot;</FONT></B>, argv[na + 1]);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> 0;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'2'</FONT></B>:        <I><FONT COLOR="#B22222">// mimedefs
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> (na + 1 &gt;= argc) {
                  HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;Option #2 needs to be followed by an URL&quot;</FONT></B>);
                  printf(<B><FONT COLOR="#BC8F8F">&quot;Example: '-#2' /foo/bar.php\n&quot;</FONT></B>);
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  <B><FONT COLOR="#228B22">char</FONT></B> mime[256];

                  <I><FONT COLOR="#B22222">// initialiser mimedefs
</FONT></I>                  <I><FONT COLOR="#B22222">//get_userhttptype(opt,1,opt-&gt;mimedefs,NULL);
</FONT></I>                  <I><FONT COLOR="#B22222">// check
</FONT></I>                  mime[0] = <B><FONT COLOR="#BC8F8F">'\0'</FONT></B>;
                  get_httptype(opt, mime, argv[na + 1], 0);
                  <B><FONT COLOR="#A020F0">if</FONT></B> (mime[0] != <B><FONT COLOR="#BC8F8F">'\0'</FONT></B>) {
                    <B><FONT COLOR="#228B22">char</FONT></B> ext[256];

                    printf(<B><FONT COLOR="#BC8F8F">&quot;%s is '%s'\n&quot;</FONT></B>, argv[na + 1], mime);
                    ext[0] = <B><FONT COLOR="#BC8F8F">'\0'</FONT></B>;
                    give_mimext(ext, mime);
                    <B><FONT COLOR="#A020F0">if</FONT></B> (ext[0]) {
                      printf(<B><FONT COLOR="#BC8F8F">&quot;and its local type is '.%s'\n&quot;</FONT></B>, ext);
                    }
                  } <B><FONT COLOR="#A020F0">else</FONT></B> {
                    printf(<B><FONT COLOR="#BC8F8F">&quot;%s is of an unknown MIME type\n&quot;</FONT></B>, argv[na + 1]);
                  }
                  htsmain_free();
                  <B><FONT COLOR="#A020F0">return</FONT></B> 0;
                }
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'3'</FONT></B>:        <I><FONT COLOR="#B22222">// charset tests: httrack -#3 &quot;iso-8859-1&quot; &quot;café&quot;
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> (++na + 1 &lt; argc) {
                  <B><FONT COLOR="#228B22">char</FONT></B> *s =
                    hts_convertStringToUTF8(argv[na+1], strlen(argv[na+1]), argv[na]);
                  <B><FONT COLOR="#A020F0">if</FONT></B> (s != NULL) {
                    printf(<B><FONT COLOR="#BC8F8F">&quot;%s\n&quot;</FONT></B>, s);
                    free(s);
                  } <B><FONT COLOR="#A020F0">else</FONT></B> {
                    fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;invalid string for charset %s\n&quot;</FONT></B>, argv[na]);
                  }
                  na += 2;
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  fprintf(stderr,
                    <B><FONT COLOR="#BC8F8F">&quot;Option #3 needs to be followed by a charset and a string&quot;</FONT></B>);
                }
                htsmain_free();
                <B><FONT COLOR="#A020F0">return</FONT></B> 0;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'4'</FONT></B>:  <I><FONT COLOR="#B22222">// IDNA encoder: httrack -#4 &quot;www.café.com&quot;
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> (++na &lt; argc) {
                  <B><FONT COLOR="#228B22">char</FONT></B> *s = hts_convertStringUTF8ToIDNA(argv[na], strlen(argv[na]));
                  <B><FONT COLOR="#A020F0">if</FONT></B> (s != NULL) {
                    printf(<B><FONT COLOR="#BC8F8F">&quot;%s\n&quot;</FONT></B>, s);
                    free(s);
                  } <B><FONT COLOR="#A020F0">else</FONT></B> {
                    fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;invalid string '%s'\n&quot;</FONT></B>, argv[na]);
                  }
                  na += 1;
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  fprintf(stderr,
                    <B><FONT COLOR="#BC8F8F">&quot;Option #4 needs to be followed by an IDNA string&quot;</FONT></B>);
                }
                htsmain_free();
                <B><FONT COLOR="#A020F0">return</FONT></B> 0;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'5'</FONT></B>:  <I><FONT COLOR="#B22222">// IDNA encoder: httrack -#5
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> (++na &lt; argc) {
                  <B><FONT COLOR="#228B22">char</FONT></B> *s = hts_convertStringIDNAToUTF8(argv[na], strlen(argv[na]));
                  <B><FONT COLOR="#A020F0">if</FONT></B> (s != NULL) {
                    printf(<B><FONT COLOR="#BC8F8F">&quot;%s\n&quot;</FONT></B>, s);
                    free(s);
                  } <B><FONT COLOR="#A020F0">else</FONT></B> {
                    fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;invalid string '%s'\n&quot;</FONT></B>, argv[na]);
                  }
                  na += 1;
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  fprintf(stderr,
                    <B><FONT COLOR="#BC8F8F">&quot;Option #5 needs to be followed by an IDNA string&quot;</FONT></B>);
                }
                htsmain_free();
                <B><FONT COLOR="#A020F0">return</FONT></B> 0;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'6'</FONT></B>:  <I><FONT COLOR="#B22222">// entities: httrack -#6 &quot;&amp;foo;&quot; [&quot;encoding&quot;]
</FONT></I>                <B><FONT COLOR="#A020F0">if</FONT></B> (++na &lt; argc) {
                  <B><FONT COLOR="#228B22">char</FONT></B> *<B><FONT COLOR="#228B22">const</FONT></B> s = strdup(argv[na]);
                  <B><FONT COLOR="#228B22">const</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B> *<B><FONT COLOR="#228B22">const</FONT></B> enc = na + 1 &lt; argc ? argv[na + 1] : <B><FONT COLOR="#BC8F8F">&quot;UTF-8&quot;</FONT></B>;
                  <B><FONT COLOR="#A020F0">if</FONT></B> (s != NULL 
                    &amp;&amp; hts_unescapeEntitiesWithCharset(s, s, strlen(s), 
                                                       enc) == 0) {
                    printf(<B><FONT COLOR="#BC8F8F">&quot;%s\n&quot;</FONT></B>, s);
                    free(s);
                  } <B><FONT COLOR="#A020F0">else</FONT></B> {
                    fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;invalid string '%s'\n&quot;</FONT></B>, argv[na]);
                  }
                  na += 1;
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  fprintf(stderr,
                    <B><FONT COLOR="#BC8F8F">&quot;Option #6 needs to be followed by a string&quot;</FONT></B>);
                }
                htsmain_free();
                <B><FONT COLOR="#A020F0">return</FONT></B> 0;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'7'</FONT></B>:  <I><FONT COLOR="#B22222">// hashtable selftest: httrack -#7 nb_entries
</FONT></I>                basic_selftests();
                <B><FONT COLOR="#A020F0">if</FONT></B> (++na &lt; argc) {
                  <B><FONT COLOR="#228B22">char</FONT></B> *<B><FONT COLOR="#228B22">const</FONT></B> snum = strdup(argv[na]);
                  <B><FONT COLOR="#228B22">unsigned</FONT></B> <B><FONT COLOR="#228B22">long</FONT></B> count = 0;
                  <B><FONT COLOR="#228B22">const</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B> *<B><FONT COLOR="#228B22">const</FONT></B> names[] = {
                    <B><FONT COLOR="#BC8F8F">&quot;&quot;</FONT></B>, <B><FONT COLOR="#BC8F8F">&quot;add&quot;</FONT></B>, <B><FONT COLOR="#BC8F8F">&quot;delete&quot;</FONT></B>, <B><FONT COLOR="#BC8F8F">&quot;dry-add&quot;</FONT></B>, <B><FONT COLOR="#BC8F8F">&quot;dry-del&quot;</FONT></B>,
                    <B><FONT COLOR="#BC8F8F">&quot;test-exists&quot;</FONT></B>, <B><FONT COLOR="#BC8F8F">&quot;test-not-exist&quot;</FONT></B>
                  };
                  <B><FONT COLOR="#228B22">const</FONT></B> <B><FONT COLOR="#228B22">struct</FONT></B> {
                    <B><FONT COLOR="#228B22">enum</FONT></B> {
                      DO_END,
                      DO_ADD,
                      DO_DEL,
                      DO_DRY_ADD,
                      DO_DRY_DEL,
                      TEST_ADD,
                      TEST_DEL
                    } type;
                    size_t modulus;
                    size_t offset;
                  } bench[] = {
                    { DO_ADD, 4, 0 },     <I><FONT COLOR="#B22222">/* add 4/0 */</FONT></I>
                    { TEST_ADD, 4, 0 },   <I><FONT COLOR="#B22222">/* check 4/0 */</FONT></I>
                    { TEST_DEL, 4, 1 },   <I><FONT COLOR="#B22222">/* check 4/1 */</FONT></I>
                    { TEST_DEL, 4, 2 },   <I><FONT COLOR="#B22222">/* check 4/2 */</FONT></I>
                    { TEST_DEL, 4, 3 },   <I><FONT COLOR="#B22222">/* check 4/3 */</FONT></I>
                    { DO_DRY_DEL, 4, 1 }, <I><FONT COLOR="#B22222">/* del 4/1 */</FONT></I>
                    { DO_DRY_DEL, 4, 2 }, <I><FONT COLOR="#B22222">/* del 4/2 */</FONT></I>
                    { DO_DRY_DEL, 4, 3 }, <I><FONT COLOR="#B22222">/* del 4/3 */</FONT></I>
                    { DO_ADD, 4, 1 },     <I><FONT COLOR="#B22222">/* add 4/1 */</FONT></I>
                    { DO_DRY_ADD, 4, 1 }, <I><FONT COLOR="#B22222">/* add 4/1 */</FONT></I>
                    { TEST_ADD, 4, 0 },   <I><FONT COLOR="#B22222">/* check 4/0 */</FONT></I>
                    { TEST_ADD, 4, 1 },   <I><FONT COLOR="#B22222">/* check 4/1 */</FONT></I>
                    { TEST_DEL, 4, 2 },   <I><FONT COLOR="#B22222">/* check 4/2 */</FONT></I>
                    { TEST_DEL, 4, 3 },   <I><FONT COLOR="#B22222">/* check 4/3 */</FONT></I>
                    { DO_ADD, 4, 2 },     <I><FONT COLOR="#B22222">/* add 4/2 */</FONT></I>
                    { DO_DRY_DEL, 4, 3 }, <I><FONT COLOR="#B22222">/* del 4/3 */</FONT></I>
                    { DO_ADD, 4, 3 },     <I><FONT COLOR="#B22222">/* add 4/3 */</FONT></I>
                    { DO_DEL, 4, 3 },     <I><FONT COLOR="#B22222">/* del 4/3 */</FONT></I>
                    { TEST_ADD, 4, 0 },   <I><FONT COLOR="#B22222">/* check 4/0 */</FONT></I>
                    { TEST_ADD, 4, 1 },   <I><FONT COLOR="#B22222">/* check 4/1 */</FONT></I>
                    { TEST_ADD, 4, 2 },   <I><FONT COLOR="#B22222">/* check 4/2 */</FONT></I>
                    { TEST_DEL, 4, 3 },   <I><FONT COLOR="#B22222">/* check 4/3 */</FONT></I>
                    { DO_DEL, 4, 0 },     <I><FONT COLOR="#B22222">/* del 4/0 */</FONT></I>
                    { DO_DEL, 4, 1 },     <I><FONT COLOR="#B22222">/* del 4/1 */</FONT></I>
                    { DO_DEL, 4, 2 },     <I><FONT COLOR="#B22222">/* del 4/2 */</FONT></I>
                    <I><FONT COLOR="#B22222">/* empty here */</FONT></I>
                    { TEST_DEL, 1, 0 },   <I><FONT COLOR="#B22222">/* check */</FONT></I>
                    { DO_ADD, 4, 0 },     <I><FONT COLOR="#B22222">/* add 4/0 */</FONT></I>
                    { DO_ADD, 4, 1 },     <I><FONT COLOR="#B22222">/* add 4/1 */</FONT></I>
                    { DO_ADD, 4, 2 },     <I><FONT COLOR="#B22222">/* add 4/2 */</FONT></I>
                    { DO_DEL, 42, 0 },    <I><FONT COLOR="#B22222">/* add 42/0 */</FONT></I>
                    { TEST_DEL, 42, 0 },  <I><FONT COLOR="#B22222">/* check 42/0 */</FONT></I>
                    { TEST_ADD, 42, 2 },  <I><FONT COLOR="#B22222">/* check 42/2 */</FONT></I>
                    { DO_END }
                  };
                  <B><FONT COLOR="#228B22">char</FONT></B> *buff = NULL;
                  <B><FONT COLOR="#228B22">const</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B> **strings = NULL;

                  <I><FONT COLOR="#B22222">/* produce key #i */</FONT></I>
#<B><FONT COLOR="#5F9EA0">define</FONT></B> <B><FONT COLOR="#0000FF">FMT</FONT></B>() \
                  char buffer[256]; \
                  const char *name; \
                  const long expected = (long) i * 1664525 + 1013904223; \
                  do { \
                    if (strings == NULL) { \
                      snprintf(buffer, sizeof(buffer), \
                        <B><FONT COLOR="#BC8F8F">&quot;http://www.example.com/website/sample/for/hashtable/&quot;</FONT></B> \
                        <B><FONT COLOR="#BC8F8F">&quot;%ld/index.html?foo=%ld&amp;bar&quot;</FONT></B>, \
                        (long) i, (long) (expected)); \
                      name = buffer; \
                    } else { \
                      name = strings[i]; \
                    } \
                  } while(0)

                  <I><FONT COLOR="#B22222">/* produce random patterns, or read from a file */</FONT></I>
                  <B><FONT COLOR="#A020F0">if</FONT></B> (sscanf(snum, <B><FONT COLOR="#BC8F8F">&quot;%lu&quot;</FONT></B>, &amp;count) != 1) {
                    <B><FONT COLOR="#228B22">const</FONT></B> off_t size = fsize(snum);
                    FILE *fp = fopen(snum, <B><FONT COLOR="#BC8F8F">&quot;rb&quot;</FONT></B>);
                    <B><FONT COLOR="#A020F0">if</FONT></B> (fp != NULL) {
                      buff = malloc(size);
                      <B><FONT COLOR="#A020F0">if</FONT></B> (buff != NULL &amp;&amp; fread(buff, 1, size, fp) == size) {
                        size_t capa = 0;
                        size_t i, last;
                        <B><FONT COLOR="#A020F0">for</FONT></B>(i = 0, last = 0, count = 0 ; i &lt; size ; i++) {
                          <B><FONT COLOR="#A020F0">if</FONT></B> (buff[i] == 10 || buff[i] == 0) {
                            buff[i] = <B><FONT COLOR="#BC8F8F">'\0'</FONT></B>;
                            <B><FONT COLOR="#A020F0">if</FONT></B> (capa == count) {
                              <B><FONT COLOR="#A020F0">if</FONT></B> (capa == 0) {
                                capa = 16;
                              } <B><FONT COLOR="#A020F0">else</FONT></B> {
                                capa &lt;&lt;= 1;
                              }
                              strings = (<B><FONT COLOR="#228B22">const</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B> **) realloc((<B><FONT COLOR="#228B22">void</FONT></B>*) strings, capa*<B><FONT COLOR="#A020F0">sizeof</FONT></B>(<B><FONT COLOR="#228B22">char</FONT></B>*));
                            }
                            strings[count++] = &amp;buff[last];
                            last = i + 1;
                          }
                        }
                      }
                      fclose(fp);
                    }
                  }

                  <I><FONT COLOR="#B22222">/* successfully read */</FONT></I>
                  <B><FONT COLOR="#A020F0">if</FONT></B> (count &gt; 0) {
                    coucal hashtable = coucal_new(0);
                    size_t loop;
                    <B><FONT COLOR="#A020F0">for</FONT></B>(loop = 0 ; bench[loop].type != DO_END ; loop++) {
                      size_t i;
                      <B><FONT COLOR="#A020F0">for</FONT></B>(i = bench[loop].offset ; i &lt; (size_t) count
                          ; i += bench[loop].modulus) {
                        <B><FONT COLOR="#228B22">int</FONT></B> result;
                        FMT();
                        <B><FONT COLOR="#A020F0">if</FONT></B> (bench[loop].type == DO_ADD
                            || bench[loop].type == DO_DRY_ADD) {
                          size_t k;
                          result = coucal_write(hashtable, name, (uintptr_t) expected);
                          <B><FONT COLOR="#A020F0">for</FONT></B>(k = 0 ; k &lt; <I><FONT COLOR="#B22222">/* stash_size*2 */</FONT></I> 32 ; k++) {
                            (<B><FONT COLOR="#228B22">void</FONT></B>) coucal_write(hashtable, name, (uintptr_t) expected);
                          }
                          <I><FONT COLOR="#B22222">/* revert logic */</FONT></I>
                          <B><FONT COLOR="#A020F0">if</FONT></B> (bench[loop].type == DO_DRY_ADD) {
                            result = result ? 0 : 1;
                          }
                        }
                        <B><FONT COLOR="#A020F0">else</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> (bench[loop].type == DO_DEL
                            || bench[loop].type == DO_DRY_DEL) {
                          size_t k;
                          result = coucal_remove(hashtable, name);
                          <B><FONT COLOR="#A020F0">for</FONT></B>(k = 0 ; k &lt; <I><FONT COLOR="#B22222">/* stash_size*2 */</FONT></I> 32 ; k++) {
                            (<B><FONT COLOR="#228B22">void</FONT></B>) coucal_remove(hashtable, name);
                          }
                          <I><FONT COLOR="#B22222">/* revert logic */</FONT></I>
                          <B><FONT COLOR="#A020F0">if</FONT></B> (bench[loop].type == DO_DRY_DEL) {
                            result = result ? 0 : 1;
                          }
                        }
                        <B><FONT COLOR="#A020F0">else</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> (bench[loop].type == TEST_ADD
                            || bench[loop].type == TEST_DEL) {
                          intptr_t value = -1;
                          result = coucal_readptr(hashtable, name, &amp;value);
                          <B><FONT COLOR="#A020F0">if</FONT></B> (bench[loop].type == TEST_ADD &amp;&amp; result
                              &amp;&amp; value != expected) {
                            fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;value failed for %s (expected %ld, got %ld)\n&quot;</FONT></B>,
                                    name, (<B><FONT COLOR="#228B22">long</FONT></B>) expected, (<B><FONT COLOR="#228B22">long</FONT></B>) value);
                            exit(EXIT_FAILURE);
                          }
                          <I><FONT COLOR="#B22222">/* revert logic */</FONT></I>
                          <B><FONT COLOR="#A020F0">if</FONT></B> (bench[loop].type == TEST_DEL) {
                            result = result ? 0 : 1;
                          }
                        }
                        <B><FONT COLOR="#A020F0">if</FONT></B> (!result) {
                          fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;failed %s{%d/+%d} test on loop %ld&quot;</FONT></B>
                                  <B><FONT COLOR="#BC8F8F">&quot; at offset %ld for %s\n&quot;</FONT></B>,
                                  names[bench[loop].type],
                                  (<B><FONT COLOR="#228B22">int</FONT></B>) bench[loop].modulus,
                                  (<B><FONT COLOR="#228B22">int</FONT></B>) bench[loop].offset,
                                  (<B><FONT COLOR="#228B22">long</FONT></B>) loop, (<B><FONT COLOR="#228B22">long</FONT></B>) i, name);
                          exit(EXIT_FAILURE);
                        }
                      }
                    }
                    coucal_delete(&amp;hashtable);
                    fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;all hashtable tests were successful!\n&quot;</FONT></B>);
                  } <B><FONT COLOR="#A020F0">else</FONT></B> {
                    fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;Malformed number\n&quot;</FONT></B>);
                    exit(EXIT_FAILURE);
                  }
#<B><FONT COLOR="#5F9EA0">undef</FONT></B> <FONT COLOR="#B8860B">FMT</FONT>
                } <B><FONT COLOR="#A020F0">else</FONT></B> {
                  fprintf(stderr,
                    <B><FONT COLOR="#BC8F8F">&quot;Option #7 needs to be followed by a number&quot;</FONT></B>);
                  exit(EXIT_FAILURE);
                }
                htsmain_free();
                <B><FONT COLOR="#A020F0">return</FONT></B> 0;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'!'</FONT></B>:
                HTS_PANIC_PRINTF
                  (<B><FONT COLOR="#BC8F8F">&quot;Option #! is disabled for security reasons&quot;</FONT></B>);
                htsmain_free();
                <B><FONT COLOR="#A020F0">return</FONT></B> -1;
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'d'</FONT></B>:
                opt-&gt;parsedebug = 1;
                <B><FONT COLOR="#A020F0">break</FONT></B>;

                <I><FONT COLOR="#B22222">/* autotest */</FONT></I>
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'t'</FONT></B>:        <I><FONT COLOR="#B22222">/* not yet implemented */</FONT></I>
                fprintf(stderr, <B><FONT COLOR="#BC8F8F">&quot;** AUTOCHECK OK\n&quot;</FONT></B>);
                <B><FONT COLOR="#A020F0">return</FONT></B> 0;
                <B><FONT COLOR="#A020F0">break</FONT></B>;

#<B><FONT COLOR="#5F9EA0">ifdef</FONT></B> <FONT COLOR="#B8860B">HTS_CRASH_TEST</FONT>
              <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'c'</FONT></B>:  <I><FONT COLOR="#B22222">/* crash test */</FONT></I>
                do_crash();
                <B><FONT COLOR="#A020F0">break</FONT></B>;
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>

              <B><FONT COLOR="#5F9EA0">default</FONT></B>:
                printf(<B><FONT COLOR="#BC8F8F">&quot;Internal option %c not recognized\n&quot;</FONT></B>, *com);
                <B><FONT COLOR="#A020F0">break</FONT></B>;
              }
            }
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'O'</FONT></B>:            <I><FONT COLOR="#B22222">// output path
</FONT></I>            <B><FONT COLOR="#A020F0">while</FONT></B>(isdigit(com[1])) {
              com++;
            }
            na++;               <I><FONT COLOR="#B22222">// sauter, déja traité
</FONT></I>            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'P'</FONT></B>:            <I><FONT COLOR="#B22222">// proxy
</FONT></I>            <B><FONT COLOR="#A020F0">if</FONT></B> ((na + 1 &gt;= argc) || (argv[na + 1][0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>)) {
              HTS_PANIC_PRINTF
                (<B><FONT COLOR="#BC8F8F">&quot;Option P needs to be followed by a blank space, and a proxy proxy:port or user:id@proxy:port&quot;</FONT></B>);
              printf(<B><FONT COLOR="#BC8F8F">&quot;Example: -P proxy.myhost.com:8080\n&quot;</FONT></B>);
              htsmain_free();
              <B><FONT COLOR="#A020F0">return</FONT></B> -1;
            } <B><FONT COLOR="#A020F0">else</FONT></B> {
              <B><FONT COLOR="#228B22">char</FONT></B> *a;

              na++;
              opt-&gt;proxy.active = 1;
              <I><FONT COLOR="#B22222">// Rechercher MAIS en partant de la fin à cause de user:pass@proxy:port
</FONT></I>              a = argv[na] + strlen(argv[na]) - 1;
              <I><FONT COLOR="#B22222">// a=strstr(argv[na],&quot;:&quot;);  // port
</FONT></I>              <B><FONT COLOR="#A020F0">while</FONT></B>((a &gt; argv[na]) &amp;&amp; (*a != <B><FONT COLOR="#BC8F8F">':'</FONT></B>) &amp;&amp; (*a != <B><FONT COLOR="#BC8F8F">'@'</FONT></B>))
                a--;
              <B><FONT COLOR="#A020F0">if</FONT></B> (*a == <B><FONT COLOR="#BC8F8F">':'</FONT></B>) {  <I><FONT COLOR="#B22222">// un port est présent, &lt;proxy&gt;:port
</FONT></I>                sscanf(a + 1, <B><FONT COLOR="#BC8F8F">&quot;%d&quot;</FONT></B>, &amp;opt-&gt;proxy.port);
                StringCopyN(opt-&gt;proxy.name, argv[na], (<B><FONT COLOR="#228B22">int</FONT></B>) (a - argv[na]));
              } <B><FONT COLOR="#A020F0">else</FONT></B> {          <I><FONT COLOR="#B22222">// &lt;proxy&gt;
</FONT></I>                opt-&gt;proxy.port = 8080;
                StringCopy(opt-&gt;proxy.name, argv[na]);
              }
            }
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'F'</FONT></B>:            <I><FONT COLOR="#B22222">// user-agent field
</FONT></I>            <B><FONT COLOR="#A020F0">if</FONT></B> ((na + 1 &gt;= argc) || (argv[na + 1][0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>)) {
              HTS_PANIC_PRINTF
                (<B><FONT COLOR="#BC8F8F">&quot;Option F needs to be followed by a blank space, and a user-agent name&quot;</FONT></B>);
              printf(<B><FONT COLOR="#BC8F8F">&quot;Example: -F \&quot;my_user_agent/1.0\&quot;\n&quot;</FONT></B>);
              htsmain_free();
              <B><FONT COLOR="#A020F0">return</FONT></B> -1;
            } <B><FONT COLOR="#A020F0">else</FONT></B> {
              na++;
              <B><FONT COLOR="#A020F0">if</FONT></B> (strlen(argv[na]) &gt;= 126) {
                HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;User-agent length too long&quot;</FONT></B>);
                htsmain_free();
                <B><FONT COLOR="#A020F0">return</FONT></B> -1;
              }
              StringCopy(opt-&gt;user_agent, argv[na]);
              <B><FONT COLOR="#A020F0">if</FONT></B> (StringNotEmpty(opt-&gt;user_agent))
                opt-&gt;user_agent_send = 1;
              <B><FONT COLOR="#A020F0">else</FONT></B>
                opt-&gt;user_agent_send = 0;       <I><FONT COLOR="#B22222">// -F &quot;&quot; désactive l'option
</FONT></I>            }
            <B><FONT COLOR="#A020F0">break</FONT></B>;
            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#A020F0">case</FONT></B> <B><FONT COLOR="#BC8F8F">'V'</FONT></B>:            <I><FONT COLOR="#B22222">// execute command
</FONT></I>            <B><FONT COLOR="#A020F0">if</FONT></B> ((na + 1 &gt;= argc) || (argv[na + 1][0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>)) {
              HTS_PANIC_PRINTF
                (<B><FONT COLOR="#BC8F8F">&quot;Option V needs to be followed by a system-command string&quot;</FONT></B>);
              printf(<B><FONT COLOR="#BC8F8F">&quot;Example: -V \&quot;tar uvf some.tar \\$0\&quot;\n&quot;</FONT></B>);
              htsmain_free();
              <B><FONT COLOR="#A020F0">return</FONT></B> -1;
            } <B><FONT COLOR="#A020F0">else</FONT></B> {
              na++;
              <B><FONT COLOR="#A020F0">if</FONT></B> (strlen(argv[na]) &gt;= 2048) {
                HTS_PANIC_PRINTF(<B><FONT COLOR="#BC8F8F">&quot;System-command length too long&quot;</FONT></B>);
                htsmain_free();
                <B><FONT COLOR="#A020F0">return</FONT></B> -1;
              }
              StringCopy(opt-&gt;sys_com, argv[na]);
              <B><FONT COLOR="#A020F0">if</FONT></B> (StringNotEmpty(opt-&gt;sys_com))
                opt-&gt;sys_com_exec = 1;
              <B><FONT COLOR="#A020F0">else</FONT></B>
                opt-&gt;sys_com_exec = 0;  <I><FONT COLOR="#B22222">// -V &quot;&quot; désactive l'option
</FONT></I>            }
            <B><FONT COLOR="#A020F0">break</FONT></B>;
            <I><FONT COLOR="#B22222">//
</FONT></I>          <B><FONT COLOR="#5F9EA0">default</FONT></B>:{
              <B><FONT COLOR="#228B22">char</FONT></B> s[HTS_CDLMAXSIZE + 256];

              sprintf(s, <B><FONT COLOR="#BC8F8F">&quot;invalid option %c\n&quot;</FONT></B>, *com);
              HTS_PANIC_PRINTF(s);
              htsmain_free();
              <B><FONT COLOR="#A020F0">return</FONT></B> -1;
            }
            <B><FONT COLOR="#A020F0">break</FONT></B>;
          }                     <I><FONT COLOR="#B22222">// switch
</FONT></I>          com++;
        }                       <I><FONT COLOR="#B22222">// while
</FONT></I>
      } <B><FONT COLOR="#A020F0">else</FONT></B> {                  <I><FONT COLOR="#B22222">// URL/filters
</FONT></I>        <B><FONT COLOR="#228B22">char</FONT></B> catbuff[CATBUFF_SIZE];
        <B><FONT COLOR="#228B22">const</FONT></B> <B><FONT COLOR="#228B22">int</FONT></B> urlSize = (<B><FONT COLOR="#228B22">int</FONT></B>) strlen(argv[na]);
        <B><FONT COLOR="#228B22">const</FONT></B> <B><FONT COLOR="#228B22">int</FONT></B> capa = (<B><FONT COLOR="#228B22">int</FONT></B>) (strlen(url) + urlSize + 32);

        assertf(urlSize &lt; HTS_URLMAXSIZE);
        <B><FONT COLOR="#A020F0">if</FONT></B> (urlSize &lt; HTS_URLMAXSIZE) {
          ensureUrlCapacity(url, url_sz, capa);
          <B><FONT COLOR="#A020F0">if</FONT></B> (strnotempty(url))
            strcatbuff(url, <B><FONT COLOR="#BC8F8F">&quot; &quot;</FONT></B>);       <I><FONT COLOR="#B22222">// espace de séparation
</FONT></I>          append_escape_spc_url(unescape_http_unharm(catbuff, <B><FONT COLOR="#A020F0">sizeof</FONT></B>(catbuff), argv[na], 1), url, url_sz);
        }
      }                         <I><FONT COLOR="#B22222">// if argv=- etc. 
</FONT></I>
    }                           <I><FONT COLOR="#B22222">// for
</FONT></I>  }

#<B><FONT COLOR="#5F9EA0">if</FONT></B> <FONT COLOR="#B8860B">BDEBUG</FONT>==3
  printf(<B><FONT COLOR="#BC8F8F">&quot;URLs/filters=%s\n&quot;</FONT></B>, url);
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>

#<B><FONT COLOR="#5F9EA0">if</FONT></B> <FONT COLOR="#B8860B">DEBUG_STEPS</FONT>
  printf(<B><FONT COLOR="#BC8F8F">&quot;Analyzing parameters done\n&quot;</FONT></B>);
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>

#<B><FONT COLOR="#5F9EA0">ifdef</FONT></B> <FONT COLOR="#B8860B">_WIN32</FONT>
#<B><FONT COLOR="#5F9EA0">else</FONT></B>
#<B><FONT COLOR="#5F9EA0">ifndef</FONT></B> <FONT COLOR="#B8860B">HTS_DO_NOT_USE_UID</FONT>
  <I><FONT COLOR="#B22222">/* Check we do not run as r00t */</FONT></I>
  {
    uid_t userid = getuid();

    <B><FONT COLOR="#A020F0">if</FONT></B> (userid == 0) {              <I><FONT COLOR="#B22222">/* running as r00t */</FONT></I>
      printf(<B><FONT COLOR="#BC8F8F">&quot;WARNING! You are running this program as root!\n&quot;</FONT></B>);
      printf
        (<B><FONT COLOR="#BC8F8F">&quot;It might be a good idea to run as a different user\n&quot;</FONT></B>);
    }
  }
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>

  <I><FONT COLOR="#B22222">//printf(&quot;WARNING! This is *only* a beta-release of HTTrack\n&quot;);
</FONT></I>  io_flush;

#<B><FONT COLOR="#5F9EA0">if</FONT></B> <FONT COLOR="#B8860B">DEBUG_STEPS</FONT>
  printf(<B><FONT COLOR="#BC8F8F">&quot;Cache &amp; log settings\n&quot;</FONT></B>);
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>

  <I><FONT COLOR="#B22222">// on utilise le cache..
</FONT></I>  <I><FONT COLOR="#B22222">// en cas de présence des deux versions, garder la version la plus avancée,
</FONT></I>  <I><FONT COLOR="#B22222">// cad la version contenant le plus de fichiers  
</FONT></I>  <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;cache) {
    <B><FONT COLOR="#A020F0">if</FONT></B> (fexist(fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-in_progress.lock&quot;</FONT></B>))) {        <I><FONT COLOR="#B22222">// problemes..
</FONT></I>      <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
          (fconcat
           (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
            <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.dat&quot;</FONT></B>))) {
        <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
            (fconcat
             (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
              <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.zip&quot;</FONT></B>))) {
          <B><FONT COLOR="#A020F0">if</FONT></B> (fsize
              (fconcat
               (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.zip&quot;</FONT></B>)) &lt; 32768) {
            <B><FONT COLOR="#A020F0">if</FONT></B> (fsize
                (fconcat
                 (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                  <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.zip&quot;</FONT></B>)) &gt; 65536) {
              <B><FONT COLOR="#A020F0">if</FONT></B> (fsize
                  (fconcat
                   (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                    <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.zip&quot;</FONT></B>)) &gt; fsize(fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
                                                          StringBuff(opt-&gt;
                                                                     path_log),
                                                          <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.zip&quot;</FONT></B>)))
              {
                remove(fconcat
                       (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                        <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.zip&quot;</FONT></B>));
                rename(fconcat
                       (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                        <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.zip&quot;</FONT></B>), fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
                                                      StringBuff(opt-&gt;path_log),
                                                      <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.zip&quot;</FONT></B>));
              }
            }
          }
        }
      } <B><FONT COLOR="#A020F0">else</FONT></B>
        <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
            (fconcat
             (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
              <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.dat&quot;</FONT></B>))
            &amp;&amp;
            fexist(fconcat
                   (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                    <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.ndx&quot;</FONT></B>))) {
        <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
            (fconcat
             (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
              <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.dat&quot;</FONT></B>))
            &amp;&amp;
            fexist(fconcat
                   (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                    <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.ndx&quot;</FONT></B>))) {
          <I><FONT COLOR="#B22222">// switcher si new&lt;32Ko et old&gt;65Ko (tailles arbitraires) ?
</FONT></I>          <I><FONT COLOR="#B22222">// ce cas est peut être une erreur ou un crash d'un miroir ancien, prendre
</FONT></I>          <I><FONT COLOR="#B22222">// alors l'ancien cache
</FONT></I>          <B><FONT COLOR="#A020F0">if</FONT></B> (fsize
              (fconcat
               (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.dat&quot;</FONT></B>)) &lt; 32768) {
            <B><FONT COLOR="#A020F0">if</FONT></B> (fsize
                (fconcat
                 (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                  <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.dat&quot;</FONT></B>)) &gt; 65536) {
              <B><FONT COLOR="#A020F0">if</FONT></B> (fsize
                  (fconcat
                   (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                    <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.dat&quot;</FONT></B>)) &gt; fsize(fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
                                                          StringBuff(opt-&gt;
                                                                     path_log),
                                                          <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.dat&quot;</FONT></B>)))
              {
                remove(fconcat
                       (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                        <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.dat&quot;</FONT></B>));
                remove(fconcat
                       (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                        <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.ndx&quot;</FONT></B>));
                rename(fconcat
                       (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                        <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.dat&quot;</FONT></B>), fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
                                                      StringBuff(opt-&gt;path_log),
                                                      <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.dat&quot;</FONT></B>));
                rename(fconcat
                       (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                        <B><FONT COLOR="#BC8F8F">&quot;hts-cache/old.ndx&quot;</FONT></B>), fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt),
                                                      StringBuff(opt-&gt;path_log),
                                                      <B><FONT COLOR="#BC8F8F">&quot;hts-cache/new.ndx&quot;</FONT></B>));
                <I><FONT COLOR="#B22222">//} else {  // ne rien faire
</FONT></I>                <I><FONT COLOR="#B22222">//  remove(&quot;hts-cache/old.dat&quot;);
</FONT></I>                <I><FONT COLOR="#B22222">//  remove(&quot;hts-cache/old.ndx&quot;);
</FONT></I>              }
            }
          }
        }
      }
    }
  }
  <I><FONT COLOR="#B22222">// Débuggage des en têtes
</FONT></I>  <B><FONT COLOR="#A020F0">if</FONT></B> (_DEBUG_HEAD) {
    ioinfo =
      fopen(fconcat
            (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-ioinfo.txt&quot;</FONT></B>),
            <B><FONT COLOR="#BC8F8F">&quot;wb&quot;</FONT></B>);
  }

  {
    <B><FONT COLOR="#228B22">char</FONT></B> n_lock[256];

    <I><FONT COLOR="#B22222">// on peut pas avoir un affichage ET un fichier log
</FONT></I>    <I><FONT COLOR="#B22222">// ca sera pour la version 2
</FONT></I>    <B><FONT COLOR="#A020F0">if</FONT></B> (httrack_logmode == 1) {
      opt-&gt;log = stdout;
      opt-&gt;errlog = stderr;
    } <B><FONT COLOR="#A020F0">else</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> (httrack_logmode &gt;= 2) {
      <I><FONT COLOR="#B22222">// deux fichiers log
</FONT></I>      structcheck(StringBuff(opt-&gt;path_log));
      <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
          (fconcat
           (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-log.txt&quot;</FONT></B>)))
        remove(fconcat
               (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-log.txt&quot;</FONT></B>));
      <B><FONT COLOR="#A020F0">if</FONT></B> (fexist
          (fconcat
           (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-err.txt&quot;</FONT></B>)))
        remove(fconcat
               (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-err.txt&quot;</FONT></B>));

      <I><FONT COLOR="#B22222">/* Check FS directory structure created */</FONT></I>
      structcheck(StringBuff(opt-&gt;path_log));

      opt-&gt;log =
        fopen(fconcat
              (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-log.txt&quot;</FONT></B>),
              <B><FONT COLOR="#BC8F8F">&quot;w&quot;</FONT></B>);
      <B><FONT COLOR="#A020F0">if</FONT></B> (httrack_logmode == 2)
        opt-&gt;errlog =
          fopen(fconcat
                (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-err.txt&quot;</FONT></B>),
                <B><FONT COLOR="#BC8F8F">&quot;w&quot;</FONT></B>);
      <B><FONT COLOR="#A020F0">else</FONT></B>
        opt-&gt;errlog = opt-&gt;log;
      <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;log == NULL) {
        <B><FONT COLOR="#228B22">char</FONT></B> s[HTS_CDLMAXSIZE + 256];

        sprintf(s, <B><FONT COLOR="#BC8F8F">&quot;Unable to create log file %s&quot;</FONT></B>,
                fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                        <B><FONT COLOR="#BC8F8F">&quot;hts-log.txt&quot;</FONT></B>));
        HTS_PANIC_PRINTF(s);
        htsmain_free();
        <B><FONT COLOR="#A020F0">return</FONT></B> -1;
      } <B><FONT COLOR="#A020F0">else</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;errlog == NULL) {
        <B><FONT COLOR="#228B22">char</FONT></B> s[HTS_CDLMAXSIZE + 256];

        sprintf(s, <B><FONT COLOR="#BC8F8F">&quot;Unable to create log file %s&quot;</FONT></B>,
                fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                        <B><FONT COLOR="#BC8F8F">&quot;hts-err.txt&quot;</FONT></B>));
        HTS_PANIC_PRINTF(s);
        htsmain_free();
        <B><FONT COLOR="#A020F0">return</FONT></B> -1;
      }

    } <B><FONT COLOR="#A020F0">else</FONT></B> {
      opt-&gt;log = NULL;
      opt-&gt;errlog = NULL;
    }

    <I><FONT COLOR="#B22222">// un petit lock-file pour indiquer un miroir en cours, ainsi qu'un éventuel fichier log
</FONT></I>    {
      FILE *fp = NULL;

      <I><FONT COLOR="#B22222">//int n=0;
</FONT></I>      <B><FONT COLOR="#228B22">char</FONT></B> t[256];

      time_local_rfc822(t);     <I><FONT COLOR="#B22222">// faut bien que ca serve quelque part l'heure RFC1945 arf'
</FONT></I>
      <I><FONT COLOR="#B22222">/* readme for information purpose */</FONT></I>
      {
        FILE *fp =
          fopen(fconcat
                (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                 <B><FONT COLOR="#BC8F8F">&quot;hts-cache/readme.txt&quot;</FONT></B>), <B><FONT COLOR="#BC8F8F">&quot;wb&quot;</FONT></B>);
        <B><FONT COLOR="#A020F0">if</FONT></B> (fp) {
          fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;What's in this folder?&quot;</FONT></B> LF);
          fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;&quot;</FONT></B> LF);
          fprintf(fp,
                  <B><FONT COLOR="#BC8F8F">&quot;This folder (hts-cache) has been generated by WinHTTrack &quot;</FONT></B>
                  HTTRACK_VERSION <B><FONT COLOR="#BC8F8F">&quot;%s&quot;</FONT></B> LF, hts_get_version_info(opt));
          fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;and is used for updating this website.&quot;</FONT></B> LF);
          fprintf(fp,
                  <B><FONT COLOR="#BC8F8F">&quot;(The HTML website structure is stored here to allow fast updates)&quot;</FONT></B>
                  LF <B><FONT COLOR="#BC8F8F">&quot;&quot;</FONT></B> LF);
          fprintf(fp,
                  <B><FONT COLOR="#BC8F8F">&quot;DO NOT delete this folder unless you do not want to update the mirror in the future!!&quot;</FONT></B>
                  LF);
          fprintf(fp,
                  <B><FONT COLOR="#BC8F8F">&quot;(you can safely delete old.zip and old.lst files, however)&quot;</FONT></B>
                  LF);
          fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;&quot;</FONT></B> LF);
          fprintf(fp, HTS_LOG_SECURITY_WARNING);
          fclose(fp);
        }
      }

      strcpy(n_lock,
             fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                     <B><FONT COLOR="#BC8F8F">&quot;hts-in_progress.lock&quot;</FONT></B>));
      <I><FONT COLOR="#B22222">//sprintf(n_lock,fconcat(OPT_GET_BUFF(opt), StringBuff(opt-&gt;path_log),&quot;hts-in_progress.lock&quot;),n);
</FONT></I>      <I><FONT COLOR="#B22222">/*do {
         if (!n)
         sprintf(n_lock,fconcat(OPT_GET_BUFF(opt), StringBuff(opt-&gt;path_log),&quot;hts-in_progress.lock&quot;),n);
         else
         sprintf(n_lock,fconcat(OPT_GET_BUFF(opt), StringBuff(opt-&gt;path_log),&quot;hts-in_progress%d.lock&quot;),n);
         n++;
         } while((fexist(n_lock)) &amp;&amp; opt-&gt;quiet);      
         if (fexist(n_lock)) {
         if (!recuperer) {
         remove(n_lock);
         }
         } */</FONT></I>

      <I><FONT COLOR="#B22222">// vérifier existence de la structure
</FONT></I>      structcheck(fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_html), <B><FONT COLOR="#BC8F8F">&quot;/&quot;</FONT></B>));
      structcheck(fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;/&quot;</FONT></B>));

      <I><FONT COLOR="#B22222">// reprise/update
</FONT></I>      <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;cache) {
        FILE *fp;
        <B><FONT COLOR="#228B22">int</FONT></B> i;

#<B><FONT COLOR="#5F9EA0">ifdef</FONT></B> <FONT COLOR="#B8860B">_WIN32</FONT>
        mkdir(fconcat
              (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-cache&quot;</FONT></B>));
#<B><FONT COLOR="#5F9EA0">else</FONT></B>
        mkdir(fconcat
              (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log), <B><FONT COLOR="#BC8F8F">&quot;hts-cache&quot;</FONT></B>),
              HTS_PROTECT_FOLDER);
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
        fp =
          fopen(fconcat
                (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                 <B><FONT COLOR="#BC8F8F">&quot;hts-cache/doit.log&quot;</FONT></B>), <B><FONT COLOR="#BC8F8F">&quot;wb&quot;</FONT></B>);
        <B><FONT COLOR="#A020F0">if</FONT></B> (fp) {
          <B><FONT COLOR="#A020F0">for</FONT></B>(i = 0 + 1; i &lt; argc; i++) {
            <B><FONT COLOR="#A020F0">if</FONT></B> (((strchr(argv[i], <B><FONT COLOR="#BC8F8F">' '</FONT></B>) != NULL)
                 || (strchr(argv[i], <B><FONT COLOR="#BC8F8F">'&quot;'</FONT></B>) != NULL)
                 || (strchr(argv[i], <B><FONT COLOR="#BC8F8F">'\\'</FONT></B>) != NULL)) &amp;&amp; (argv[i][0] != <B><FONT COLOR="#BC8F8F">'&quot;'</FONT></B>)) {
              size_t j;

              fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;\&quot;&quot;</FONT></B>);
              <B><FONT COLOR="#A020F0">for</FONT></B>(j = 0; argv[i][j] != <B><FONT COLOR="#BC8F8F">'\0'</FONT></B>; j++) {
                <B><FONT COLOR="#A020F0">if</FONT></B> (argv[i][j] == 34)
                  fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;\\\&quot;&quot;</FONT></B>);
                <B><FONT COLOR="#A020F0">else</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> (argv[i][j] == <B><FONT COLOR="#BC8F8F">'\\'</FONT></B>)
                  fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;\\\\&quot;</FONT></B>);
                <B><FONT COLOR="#A020F0">else</FONT></B>
                  fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;%c&quot;</FONT></B>, argv[i][j]);
              }
              fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;\&quot;&quot;</FONT></B>);
            } <B><FONT COLOR="#A020F0">else</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> (strnotempty(argv[i]) == 0) {     <I><FONT COLOR="#B22222">// &quot;&quot;
</FONT></I>              fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;\&quot;\&quot;&quot;</FONT></B>);
            } <B><FONT COLOR="#A020F0">else</FONT></B> {            <I><FONT COLOR="#B22222">// non critique
</FONT></I>              fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;%s&quot;</FONT></B>, argv[i]);
            }
            <B><FONT COLOR="#A020F0">if</FONT></B> (i &lt; argc - 1)
              fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot; &quot;</FONT></B>);
          }
          fprintf(fp, LF);
          fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;File generated automatically on %s, do NOT edit&quot;</FONT></B> LF, t);
          fprintf(fp, LF);
          fprintf(fp,
                  <B><FONT COLOR="#BC8F8F">&quot;To update a mirror, just launch httrack without any parameters&quot;</FONT></B>
                  LF);
          fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;The existing cache will be used (and modified)&quot;</FONT></B> LF);
          fprintf(fp,
                  <B><FONT COLOR="#BC8F8F">&quot;To have other options, retype all parameters and launch HTTrack&quot;</FONT></B>
                  LF);
          fprintf(fp,
                  <B><FONT COLOR="#BC8F8F">&quot;To continue an interrupted mirror, just launch httrack without any parameters&quot;</FONT></B>
                  LF);
          fprintf(fp, LF);
          fclose(fp);
          fp = NULL;
          <I><FONT COLOR="#B22222">//} else if (opt-&gt;debug&gt;1) {
</FONT></I>          <I><FONT COLOR="#B22222">//  printf(&quot;! FileOpen error, \&quot;%s\&quot;\n&quot;,strerror(errno));
</FONT></I>        }
      }
      <I><FONT COLOR="#B22222">// petit message dans le lock
</FONT></I>      <B><FONT COLOR="#A020F0">if</FONT></B> ((fp = fopen(n_lock, <B><FONT COLOR="#BC8F8F">&quot;wb&quot;</FONT></B>)) != NULL) {
        <B><FONT COLOR="#228B22">int</FONT></B> i;

        fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;Mirror in progress since %s .. please wait!&quot;</FONT></B> LF, t);
        <B><FONT COLOR="#A020F0">for</FONT></B>(i = 0; i &lt; argc; i++) {
          <B><FONT COLOR="#A020F0">if</FONT></B> (strchr(argv[i], <B><FONT COLOR="#BC8F8F">' '</FONT></B>) == NULL)
            fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;%s &quot;</FONT></B>, argv[i]);
          <B><FONT COLOR="#A020F0">else</FONT></B>                  <I><FONT COLOR="#B22222">// entre &quot;&quot;
</FONT></I>            fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;\&quot;%s\&quot; &quot;</FONT></B>, argv[i]);
        }
        fprintf(fp, LF);
        fprintf(fp,
                <B><FONT COLOR="#BC8F8F">&quot;To pause the engine: create an empty file named 'hts-stop.lock'&quot;</FONT></B>
                LF);
#<B><FONT COLOR="#5F9EA0">if</FONT></B> <FONT COLOR="#B8860B">USE_BEGINTHREAD</FONT>
        fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;PID=%d\n&quot;</FONT></B>, (<B><FONT COLOR="#228B22">int</FONT></B>) getpid());
#<B><FONT COLOR="#5F9EA0">ifndef</FONT></B> <FONT COLOR="#B8860B">_WIN32</FONT>
        fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;UID=%d\n&quot;</FONT></B>, (<B><FONT COLOR="#228B22">int</FONT></B>) getuid());
        fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;GID=%d\n&quot;</FONT></B>, (<B><FONT COLOR="#228B22">int</FONT></B>) getuid());
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
        fprintf(fp, <B><FONT COLOR="#BC8F8F">&quot;START=%d\n&quot;</FONT></B>, (<B><FONT COLOR="#228B22">int</FONT></B>) time(NULL));
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
        fclose(fp);
        fp = NULL;
      }
      <I><FONT COLOR="#B22222">// fichier log        
</FONT></I>      <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;log) {
        <B><FONT COLOR="#228B22">int</FONT></B> i;

        fprintf(opt-&gt;log,
                <B><FONT COLOR="#BC8F8F">&quot;HTTrack&quot;</FONT></B> HTTRACK_VERSION <B><FONT COLOR="#BC8F8F">&quot;%s launched on %s at %s&quot;</FONT></B> LF,
                hts_get_version_info(opt), t, url);
        fprintf(opt-&gt;log, <B><FONT COLOR="#BC8F8F">&quot;(&quot;</FONT></B>);
        <B><FONT COLOR="#A020F0">for</FONT></B>(i = 0; i &lt; argc; i++) {
#<B><FONT COLOR="#5F9EA0">ifdef</FONT></B> <FONT COLOR="#B8860B">_WIN32</FONT>
          <B><FONT COLOR="#228B22">char</FONT></B> *carg =
            hts_convertStringSystemToUTF8(argv[i], (<B><FONT COLOR="#228B22">int</FONT></B>) strlen(argv[i]));
          <B><FONT COLOR="#228B22">char</FONT></B> *arg = carg != NULL ? carg : argv[i];
#<B><FONT COLOR="#5F9EA0">else</FONT></B>
          <B><FONT COLOR="#228B22">const</FONT></B> <B><FONT COLOR="#228B22">char</FONT></B> *arg = argv[i];
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
          <B><FONT COLOR="#A020F0">if</FONT></B> (strchr(arg, <B><FONT COLOR="#BC8F8F">' '</FONT></B>) == NULL || strchr(arg, <B><FONT COLOR="#BC8F8F">'\&quot;'</FONT></B>) != NULL)
            fprintf(opt-&gt;log, <B><FONT COLOR="#BC8F8F">&quot;%s &quot;</FONT></B>, arg);
          <B><FONT COLOR="#A020F0">else</FONT></B>                  <I><FONT COLOR="#B22222">// entre &quot;&quot; (si espace(s) et pas déja de &quot;)
</FONT></I>            fprintf(opt-&gt;log, <B><FONT COLOR="#BC8F8F">&quot;\&quot;%s\&quot; &quot;</FONT></B>, arg);
#<B><FONT COLOR="#5F9EA0">ifdef</FONT></B> <FONT COLOR="#B8860B">_WIN32</FONT>
          <B><FONT COLOR="#A020F0">if</FONT></B> (carg != NULL)
            free(carg);
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>
        }
        fprintf(opt-&gt;log, <B><FONT COLOR="#BC8F8F">&quot;)&quot;</FONT></B> LF);
        fprintf(opt-&gt;log, LF);
        fprintf(opt-&gt;log,
                <B><FONT COLOR="#BC8F8F">&quot;Information, Warnings and Errors reported for this mirror:&quot;</FONT></B>
                LF);
        fprintf(opt-&gt;log, HTS_LOG_SECURITY_WARNING);
        fprintf(opt-&gt;log, LF);
      }

      <B><FONT COLOR="#A020F0">if</FONT></B> (httrack_logmode) {
        printf(<B><FONT COLOR="#BC8F8F">&quot;Mirror launched on %s by HTTrack Website Copier/&quot;</FONT></B>
               HTTRACK_VERSION <B><FONT COLOR="#BC8F8F">&quot;%s &quot;</FONT></B> HTTRACK_AFF_AUTHORS <B><FONT COLOR="#BC8F8F">&quot;&quot;</FONT></B> LF, t,
               hts_get_version_info(opt));
        <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;wizard == 0) {
          printf
            (<B><FONT COLOR="#BC8F8F">&quot;mirroring %s with %d levels, %d sockets,t=%d,s=%d,logm=%d,lnk=%d,mdg=%d\n&quot;</FONT></B>,
             url, opt-&gt;depth, opt-&gt;maxsoc, opt-&gt;travel, opt-&gt;seeker,
             httrack_logmode, opt-&gt;urlmode, opt-&gt;getmode);
        } <B><FONT COLOR="#A020F0">else</FONT></B> {                <I><FONT COLOR="#B22222">// the magic wizard
</FONT></I>          printf(<B><FONT COLOR="#BC8F8F">&quot;mirroring %s with the wizard help..\n&quot;</FONT></B>, url);
        }
      }
    }

    io_flush;

    <I><FONT COLOR="#B22222">/* Enforce limits to avoid bandwidth abuse. The bypass_limits should only be used by administrators and experts. */</FONT></I>
    <B><FONT COLOR="#A020F0">if</FONT></B> (!opt-&gt;bypass_limits) {
      <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;maxsoc &lt;= 0 || opt-&gt;maxsoc &gt; 8) {
        opt-&gt;maxsoc = 8;
        hts_log_print(opt, LOG_WARNING,
                      <B><FONT COLOR="#BC8F8F">&quot;* security warning: maximum number of simultaneous connections limited to %d to avoid server overload&quot;</FONT></B>,
                      (<B><FONT COLOR="#228B22">int</FONT></B>) opt-&gt;maxsoc);
      }
      <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;maxrate &lt;= 0 || opt-&gt;maxrate &gt; 250000) {
        opt-&gt;maxrate = 250000;
        hts_log_print(opt, LOG_WARNING,
                      <B><FONT COLOR="#BC8F8F">&quot;* security warning: maximum bandwidth limited to %d to avoid server overload&quot;</FONT></B>,
                      (<B><FONT COLOR="#228B22">int</FONT></B>) opt-&gt;maxrate);
      }
      <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;maxconn &lt;= 0 || opt-&gt;maxconn &gt; 5.0) {
        opt-&gt;maxconn = 5.0;
        hts_log_print(opt, LOG_WARNING,
                      <B><FONT COLOR="#BC8F8F">&quot;* security warning: maximum number of connections per second limited to %f to avoid server overload&quot;</FONT></B>,
                      (<B><FONT COLOR="#228B22">float</FONT></B>) opt-&gt;maxconn);
      }
    } <B><FONT COLOR="#A020F0">else</FONT></B> {
      hts_log_print(opt, LOG_WARNING,
                    <B><FONT COLOR="#BC8F8F">&quot;* security warning: !!! BYPASSING SECURITY LIMITS - MONITOR THIS SESSION WITH EXTREME CARE !!!&quot;</FONT></B>);
    }

    <I><FONT COLOR="#B22222">/* Info for wrappers */</FONT></I>
    hts_log_print(opt, LOG_DEBUG, <B><FONT COLOR="#BC8F8F">&quot;engine: init&quot;</FONT></B>);

    <I><FONT COLOR="#B22222">/* Init external */</FONT></I>
    RUN_CALLBACK_NOARG(opt, init);

    <I><FONT COLOR="#B22222">// détourner SIGHUP etc.
</FONT></I>#<B><FONT COLOR="#5F9EA0">if</FONT></B> <FONT COLOR="#B8860B">DEBUG_STEPS</FONT>
    printf(<B><FONT COLOR="#BC8F8F">&quot;Launching the mirror\n&quot;</FONT></B>);
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>

    <I><FONT COLOR="#B22222">// Lancement du miroir
</FONT></I>    <I><FONT COLOR="#B22222">// ------------------------------------------------------------
</FONT></I>    opt-&gt;state._hts_in_mirror = 1;
    <B><FONT COLOR="#A020F0">if</FONT></B> (httpmirror(url, opt) == 0) {
      printf
        (<B><FONT COLOR="#BC8F8F">&quot;Error during operation (see log file), site has not been successfully mirrored\n&quot;</FONT></B>);
    } <B><FONT COLOR="#A020F0">else</FONT></B> {
      <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;shell) {
        HTT_REQUEST_START;
        HT_PRINT(<B><FONT COLOR="#BC8F8F">&quot;TRANSFER DONE&quot;</FONT></B> LF);
      HTT_REQUEST_END} <B><FONT COLOR="#A020F0">else</FONT></B> {
        printf(<B><FONT COLOR="#BC8F8F">&quot;Done.\n&quot;</FONT></B>);
      }
    }
    opt-&gt;state._hts_in_mirror = 0;
    <I><FONT COLOR="#B22222">// ------------------------------------------------------------
</FONT></I>
    <I><FONT COLOR="#B22222">//
</FONT></I>    <I><FONT COLOR="#B22222">// Build top index
</FONT></I>    <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;dir_topindex) {
      <B><FONT COLOR="#228B22">char</FONT></B> BIGSTK rpath[1024 * 2];
      <B><FONT COLOR="#228B22">char</FONT></B> *a;

      strcpybuff(rpath, StringBuff(opt-&gt;path_html));
      <B><FONT COLOR="#A020F0">if</FONT></B> (rpath[0]) {
        <B><FONT COLOR="#A020F0">if</FONT></B> (rpath[strlen(rpath) - 1] == <B><FONT COLOR="#BC8F8F">'/'</FONT></B>)
          rpath[strlen(rpath) - 1] = <B><FONT COLOR="#BC8F8F">'\0'</FONT></B>;
      }
      a = strrchr(rpath, <B><FONT COLOR="#BC8F8F">'/'</FONT></B>);
      <B><FONT COLOR="#A020F0">if</FONT></B> (a) {
        *a = <B><FONT COLOR="#BC8F8F">'\0'</FONT></B>;
        hts_buildtopindex(opt, rpath, StringBuff(opt-&gt;path_bin));
        hts_log_print(opt, LOG_INFO, <B><FONT COLOR="#BC8F8F">&quot;Top index rebuilt (done)&quot;</FONT></B>);
      }
    }

    <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;state.exit_xh == 1) {
      <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;log) {
        fprintf(opt-&gt;log,
                <B><FONT COLOR="#BC8F8F">&quot;* * MIRROR ABORTED! * *\nThe current temporary cache is required for any update operation and only contains data downloaded during the present aborted session.\nThe former cache might contain more complete information; if you do not want to lose that information, you have to restore it and delete the current cache.\nThis can easily be done here by erasing the hts-cache/new.* files]\n&quot;</FONT></B>);
      }
    }

    <I><FONT COLOR="#B22222">/* Not or cleanly interrupted; erase hts-cache/ref temporary directory */</FONT></I>
    <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;state.exit_xh == 0) {
      <I><FONT COLOR="#B22222">// erase ref files if not interrupted
</FONT></I>      DIR *dir;
      <B><FONT COLOR="#228B22">struct</FONT></B> dirent *entry;

      <B><FONT COLOR="#A020F0">for</FONT></B>(dir =
          opendir(fconcat
                  (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log),
                   CACHE_REFNAME));
          dir != NULL &amp;&amp; (entry = readdir(dir)) != NULL;) {
        <B><FONT COLOR="#A020F0">if</FONT></B> (entry-&gt;d_name[0] != <B><FONT COLOR="#BC8F8F">'\0'</FONT></B> &amp;&amp; entry-&gt;d_name[0] != <B><FONT COLOR="#BC8F8F">'.'</FONT></B>) {
          <B><FONT COLOR="#228B22">char</FONT></B> *f = OPT_GET_BUFF(opt);

          sprintf(f, <B><FONT COLOR="#BC8F8F">&quot;%s/%s&quot;</FONT></B>, CACHE_REFNAME, entry-&gt;d_name);
          (<B><FONT COLOR="#228B22">void</FONT></B>)
            unlink(fconcat(OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log), f));
        }
      }
      <B><FONT COLOR="#A020F0">if</FONT></B> (dir != NULL) {
        (<B><FONT COLOR="#228B22">void</FONT></B>) closedir(dir);
      }
      (<B><FONT COLOR="#228B22">void</FONT></B>)
        rmdir(fconcat
              (OPT_GET_BUFF(opt), OPT_GET_BUFF_SIZE(opt), StringBuff(opt-&gt;path_log), CACHE_REFNAME));
    }

    <I><FONT COLOR="#B22222">/* Info for wrappers */</FONT></I>
    hts_log_print(opt, LOG_DEBUG, <B><FONT COLOR="#BC8F8F">&quot;engine: free&quot;</FONT></B>);

    <I><FONT COLOR="#B22222">/* UnInit */</FONT></I>
    RUN_CALLBACK_NOARG(opt, uninit);

    <B><FONT COLOR="#A020F0">if</FONT></B> (httrack_logmode != 1) {
      <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;errlog == opt-&gt;log)
        opt-&gt;errlog = NULL;
      <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;log) {
        fclose(opt-&gt;log);
        opt-&gt;log = NULL;
      }
      <B><FONT COLOR="#A020F0">if</FONT></B> (opt-&gt;errlog) {
        fclose(opt-&gt;errlog);
        opt-&gt;errlog = NULL;
      }
    }
    <I><FONT COLOR="#B22222">// Débuggage des en têtes
</FONT></I>    <B><FONT COLOR="#A020F0">if</FONT></B> (_DEBUG_HEAD) {
      <B><FONT COLOR="#A020F0">if</FONT></B> (ioinfo) {
        fclose(ioinfo);
      }
    }
    <I><FONT COLOR="#B22222">// supprimer lock
</FONT></I>    remove(n_lock);
  }

  <B><FONT COLOR="#A020F0">if</FONT></B> (x_argvblk)
    freet(x_argvblk);
  <B><FONT COLOR="#A020F0">if</FONT></B> (x_argv)
    freet(x_argv);
  <B><FONT COLOR="#A020F0">if</FONT></B> (url)
    freet(url);

#<B><FONT COLOR="#5F9EA0">ifdef</FONT></B> <FONT COLOR="#B8860B">HTS_TRACE_MALLOC</FONT>
  hts_freeall();
#<B><FONT COLOR="#5F9EA0">endif</FONT></B>

  printf(<B><FONT COLOR="#BC8F8F">&quot;Thanks for using HTTrack!\n&quot;</FONT></B>);
  io_flush;
  htsmain_free();
  <B><FONT COLOR="#A020F0">return</FONT></B> 0;                     <I><FONT COLOR="#B22222">// OK
</FONT></I>}

<I><FONT COLOR="#B22222">// main() subroutines
</FONT></I>
<I><FONT COLOR="#B22222">// vérifier chemin path
</FONT></I><B><FONT COLOR="#228B22">int</FONT></B> <B><FONT COLOR="#0000FF">check_path</FONT></B>(String * s, <B><FONT COLOR="#228B22">char</FONT></B> *defaultname) {
  <B><FONT COLOR="#228B22">int</FONT></B> i;
  <B><FONT COLOR="#228B22">int</FONT></B> return_value = 0;

  <I><FONT COLOR="#B22222">// Replace name: ~/mywebsites/# -&gt; /home/foo/mywebsites/#
</FONT></I>  expand_home(s);
  <B><FONT COLOR="#A020F0">for</FONT></B>(i = 0; i &lt; (<B><FONT COLOR="#228B22">int</FONT></B>) StringLength(*s); i++)   <I><FONT COLOR="#B22222">// conversion \ -&gt; /
</FONT></I>    <B><FONT COLOR="#A020F0">if</FONT></B> (StringSub(*s, i) == <B><FONT COLOR="#BC8F8F">'\\'</FONT></B>)
      StringSubRW(*s, i) = <B><FONT COLOR="#BC8F8F">'/'</FONT></B>;

  <I><FONT COLOR="#B22222">// remove ending /
</FONT></I>  <B><FONT COLOR="#A020F0">if</FONT></B> (StringNotEmpty(*s) &amp;&amp; StringRight(*s, 1) == <B><FONT COLOR="#BC8F8F">'/'</FONT></B>)
    StringPopRight(*s);

  <I><FONT COLOR="#B22222">// Replace name: /home/foo/mywebsites/# -&gt; /home/foo/mywebsites/wonderfulsite
</FONT></I>  <B><FONT COLOR="#A020F0">if</FONT></B> (StringNotEmpty(*s)) {
    <B><FONT COLOR="#A020F0">if</FONT></B> (StringRight(*s, 1) == <B><FONT COLOR="#BC8F8F">'#'</FONT></B>) {
      <B><FONT COLOR="#A020F0">if</FONT></B> (strnotempty((defaultname ? defaultname : <B><FONT COLOR="#BC8F8F">&quot;&quot;</FONT></B>))) {
        <B><FONT COLOR="#228B22">char</FONT></B> *a = strchr(defaultname, <B><FONT COLOR="#BC8F8F">'#'</FONT></B>);     <I><FONT COLOR="#B22222">// we never know..
</FONT></I>
        <B><FONT COLOR="#A020F0">if</FONT></B> (a)
          *a = <B><FONT COLOR="#BC8F8F">'\0'</FONT></B>;
        StringPopRight(*s);
        StringCat(*s, defaultname);
      } <B><FONT COLOR="#A020F0">else</FONT></B> {
        StringClear(*s);        <I><FONT COLOR="#B22222">// Clear path (no name/default url given)
</FONT></I>      }
      return_value = 1;         <I><FONT COLOR="#B22222">// expanded
</FONT></I>    }
  }
  <I><FONT COLOR="#B22222">// ending /
</FONT></I>  <B><FONT COLOR="#A020F0">if</FONT></B> (StringNotEmpty(*s) &amp;&amp; StringRight(*s, 1) != <B><FONT COLOR="#BC8F8F">'/'</FONT></B>)  <I><FONT COLOR="#B22222">// ajouter slash à la fin
</FONT></I>    StringCat(*s, <B><FONT COLOR="#BC8F8F">&quot;/&quot;</FONT></B>);

  <B><FONT COLOR="#A020F0">return</FONT></B> return_value;
}

<I><FONT COLOR="#B22222">// détermine si l'argument est une option
</FONT></I><B><FONT COLOR="#228B22">int</FONT></B> <B><FONT COLOR="#0000FF">cmdl_opt</FONT></B>(<B><FONT COLOR="#228B22">char</FONT></B> *s) {
  <B><FONT COLOR="#A020F0">if</FONT></B> (s[0] == <B><FONT COLOR="#BC8F8F">'-'</FONT></B>) {            <I><FONT COLOR="#B22222">// c'est peut être une option
</FONT></I>    <B><FONT COLOR="#A020F0">if</FONT></B> (strchr(s, <B><FONT COLOR="#BC8F8F">'.'</FONT></B>) != NULL &amp;&amp; strchr(s, <B><FONT COLOR="#BC8F8F">'%'</FONT></B>) == NULL)
      <B><FONT COLOR="#A020F0">return</FONT></B> 0;                 <I><FONT COLOR="#B22222">// sans doute un -www.truc.fr (note: -www n'est pas compris)
</FONT></I>    <B><FONT COLOR="#A020F0">else</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> (strchr(s, <B><FONT COLOR="#BC8F8F">'/'</FONT></B>) != NULL)
      <B><FONT COLOR="#A020F0">return</FONT></B> 0;                 <I><FONT COLOR="#B22222">// idem, -*cgi-bin/
</FONT></I>    <B><FONT COLOR="#A020F0">else</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> (strchr(s, <B><FONT COLOR="#BC8F8F">'*'</FONT></B>) != NULL)
      <B><FONT COLOR="#A020F0">return</FONT></B> 0;                 <I><FONT COLOR="#B22222">// joker, idem
</FONT></I>    <B><FONT COLOR="#A020F0">else</FONT></B>
      <B><FONT COLOR="#A020F0">return</FONT></B> 1;
  } <B><FONT COLOR="#A020F0">else</FONT></B>
    <B><FONT COLOR="#A020F0">return</FONT></B> 0;
}
</PRE>
<HR>
<ADDRESS>Generated by <A HREF="http://www.iki.fi/~mtr/genscript/">GNU Enscript 1.6.5.90</A>.</ADDRESS>
</BODY>

<!-- Mirrored from www.httrack.com/src/htscoremain.c.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 02 Jan 2023 20:31:44 GMT -->
</HTML>
